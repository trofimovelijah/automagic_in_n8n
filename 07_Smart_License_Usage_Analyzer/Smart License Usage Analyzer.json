{
  "name": "Smart License Usage Analyzer",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -4096,
        -1584
      ],
      "id": "255774f6-d648-4425-ac99-76ec7ce2dbf2",
      "name": "Webhook - Telegram Bot",
      "webhookId": "87ddb7ae-afa2-4c10-8268-5aac0252165b",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6a0aebe7-3cc2-436b-9e72-97a6755e7829",
                    "leftValue": "={{ $('Edit Fields').item.json.text }}",
                    "rightValue": "/",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "4 - User Input"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "06f8b71a-a419-4fc2-8746-c0569ad7bfbd",
                    "leftValue": "={{ $('Edit Fields').item.json.text }}",
                    "rightValue": "=/createvm",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "1 - –°–æ–∑–¥–∞–Ω–∏–µ –í–ú"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8104b393-31e7-47be-b040-daa9528965e5",
                    "leftValue": "={{ $('Edit Fields').item.json.text }}",
                    "rightValue": "=^/(myresources|softwarecatalog|vmdetails)",
                    "operator": {
                      "type": "string",
                      "operation": "regex"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "2 - –ü—Ä–æ—Å–º–æ—Ç—Ä (–æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–µ)"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8342202e-e017-4985-b2dc-c193b6942c3b",
                    "leftValue": "={{ $('Edit Fields').item.json.text }}",
                    "rightValue": "=^/(optimize|checkidle)",
                    "operator": {
                      "type": "string",
                      "operation": "regex"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "3 - –ê–Ω–∞–ª–∏–∑ (–æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–µ)"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9c276292-995f-4620-8090-129e10a08a83",
                    "leftValue": "={{ $('Edit Fields').item.json.text }}",
                    "rightValue": "=/help",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "5 - –ü–æ–º–æ—â—å"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "–û–±—Ä–∞–±–æ—Ç—á–∏–∫ Fallback: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -1344,
        -1136
      ],
      "id": "b65b5dca-3aff-42b2-9f41-652bfdac43b0",
      "name": "Command Router",
      "retryOnFail": false,
      "executeOnce": false,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "672b5415-5aae-4b51-a0d1-72f0785edaf7",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1936,
        -1568
      ],
      "id": "efae6dd4-b61b-4b94-af0d-a5d0cea59d23",
      "name": "User Registered?"
    },
    {
      "parameters": {
        "jsCode": "// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst userNode = $('Get User for VM Creation');\nif (!userNode || userNode.all().length === 0) {\n  return [{\n    json: {\n      canCreate: false,\n      currentCount: 0,\n      limit: 0,\n      error: 'User not found',\n      chat_id: $('Edit Fields').item.json.chat_id\n    },\n    pairedItem: 0\n  }];\n}\n\nconst userData = userNode.first().json;\nconst allVMs = $input.all();\n\n// –°—á–∏—Ç–∞–µ–º –í–ú —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst userVMs = allVMs.filter(vm => \n  parseInt(vm.json.user_id) === parseInt(userData.user_id)\n);\n\nconst currentCount = userVMs.length;\nconst limit = parseInt(userData.license_limit) || 0;\n\nreturn [{\n  json: {\n    canCreate: currentCount < limit,\n    currentCount,\n    limit,\n    user_id: userData.user_id,\n    telegram_id: userData.telegram_id,\n    username: userData.username,\n    chat_id: $('Edit Fields').item.json.chat_id\n  },\n  pairedItem: 0\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2480,
        -1584
      ],
      "id": "b06fcfbf-0471-4ca6-aa11-03b8e40f2234",
      "name": "Check License Limit",
      "retryOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "243b271c-bcaa-49e1-9711-4117e72a2b0d",
              "leftValue": "={{ $json.canCreate }}",
              "rightValue": "=true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2704,
        -1520
      ],
      "id": "adfab979-0385-4f08-83dc-b7a016ab4f23",
      "name": "Can Create VM?"
    },
    {
      "parameters": {
        "jsCode": "// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏ –¥–∞–Ω–Ω—ã–µ?\nlet userData = null;\n\ntry {\n  const userNode = $('Get User for VM Creation');\n  if (userNode && userNode.all().length > 0) {\n    userData = userNode.first().json;\n  }\n} catch (e) {\n  // –£–∑–µ–ª –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è ‚Äî –∑–Ω–∞—á–∏—Ç –ø—Ä–∏—à–ª–∏ —á–µ—Ä–µ–∑ State Router\n}\n\n// –ï—Å–ª–∏ userData –Ω–µ—Ç ‚Äî –ø–æ–ª—É—á–∞–µ–º –∏–∑ State Router\nif (!userData) {\n  const stateData = $('Check User State').first().json;\n  \n  // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–ª—è data\n  let parsedData = {};\n  try {\n    parsedData = typeof stateData.data === 'string' \n      ? JSON.parse(stateData.data) \n      : stateData.data || {};\n  } catch (e) {\n    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ data:', e);\n    parsedData = {};\n  }\n  \n  // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –±–µ—Ä—ë–º user_id –∏–∑ data, –ù–ï –∏–∑ telegram_id!\n  if (!parsedData.user_id) {\n    throw new Error('‚ùå –í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç user_id! –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.');\n  }\n  \n  userData = {\n    user_id: parsedData.user_id,\n    telegram_id: stateData.telegram_id,\n    username: parsedData.username || `User${parsedData.user_id}`\n  };\n}\n\n// –ü–æ–ª—É—á–∞–µ–º –≤—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç (–Ω–æ–º–µ—Ä–∞ –ü–û)\nconst userInput = $('Edit Fields').item.json.text;\n\n// –ü–∞—Ä—Å–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ ID –ü–û\nlet selectedSoftwareIds = [];\n\n// –£–±–∏—Ä–∞–µ–º –∫–æ–º–∞–Ω–¥—É /createvm –µ—Å–ª–∏ –µ—Å—Ç—å\nconst cleanInput = userInput.replace(/^\\/createvm\\s*/i, '').trim();\n\nif (cleanInput) {\n  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª –Ω–æ–º–µ—Ä–∞\n  selectedSoftwareIds = cleanInput.split(',')\n    .map(id => parseInt(id.trim()))\n    .filter(id => !isNaN(id));\n}\n\n// –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –ü–û ‚Äî –æ—à–∏–±–∫–∞!\nif (selectedSoftwareIds.length === 0) {\n  throw new Error('–ù–µ —É–∫–∞–∑–∞–Ω–æ –ü–û –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏! –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –º–µ–Ω—é.');\n}\n\n// –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –ü–û (–ë–ï–ó–û–ü–ê–°–ù–û!)\nlet softwareCatalog = [];\ntry {\n  const catalogNode = $('Load Software Catalog').first();\n  \n  if (Array.isArray(catalogNode.json)) {\n    softwareCatalog = catalogNode.json;\n  } else {\n    const allCatalog = $('Load Software Catalog').all();\n    if (Array.isArray(allCatalog)) {\n      softwareCatalog = allCatalog.map(item => item.json);\n    }\n  }\n} catch (e) {\n  console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞:', e);\n  softwareCatalog = [];\n}\n\n// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Å–ø–∏—Å–æ–∫ –ü–û\nlet monthlyCost = 0;\nconst installedSoftware = [];\n\nselectedSoftwareIds.forEach(id => {\n  const sw = softwareCatalog.find(s => parseInt(s.software_id) === id);\n  if (sw) {\n    monthlyCost += parseInt(sw.cost_per_month);\n    installedSoftware.push(sw.name);\n  }\n});\n\n// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –í–ú –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ ID (–ë–ï–ó–û–ü–ê–°–ù–û!)\nlet allVMs = [];\ntry {\n  const vmsNode = $('Get Existing VMs for User');\n  if (vmsNode && vmsNode.all) {\n    const vmsData = vmsNode.all();\n    if (Array.isArray(vmsData)) {\n      allVMs = vmsData;\n    }\n  }\n} catch (e) {\n  allVMs = [];\n}\n\n// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –£–ù–ò–ö–ê–õ–¨–ù–´–ô vmid\n// –ò—Å–ø–æ–ª—å–∑—É–µ–º timestamp + —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏\nconst timestamp = Date.now();\nconst random = Math.floor(Math.random() * 1000);\nconst newVmId = parseInt(`${timestamp}${random}`.slice(-10)); // –ë–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ü–∏—Ñ—Ä\n\n// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –£–ù–ò–ö–ê–õ–¨–ù–û–ï –∏–º—è –í–ú\n// –§–æ—Ä–º–∞—Ç: VM-[user_id]-[timestamp]-[–ü–û]\nconst shortTimestamp = timestamp.toString().slice(-6); // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 6 —Ü–∏—Ñ—Ä\nconst softwareAbbr = installedSoftware.length > 0 \n  ? installedSoftware[0].substring(0, 3).toUpperCase() \n  : 'SYS';\nconst vmName = `VM-${userData.user_id}-${shortTimestamp}-${softwareAbbr}`;\n\n// –°–∏–º—É–ª–∏—Ä—É–µ–º –º–µ—Ç—Ä–∏–∫–∏\nconst usageHours = Math.floor(Math.random() * 36) + 5; // 5-40 —á–∞—Å–æ–≤\nconst cpuUsage = Math.floor(Math.random() * 70) + 15; // 15-85%\nconst ramUsage = Math.floor(Math.random() * 60) + 30; // 30-90%\n\nlet status = 'active';\nif (usageHours < 5) status = 'stopped';\nelse if (usageHours < 20) status = 'idle';\n\nconst now = new Date();\nconst createdAt = now.toISOString().split('T')[0];\n\nreturn {\n  json: {\n    vm_id: newVmId,\n    user_id: userData.user_id,\n    vm_name: vmName,\n    software_installed: selectedSoftwareIds.join(','),\n    created_at: createdAt,\n    last_active: createdAt,\n    cpu_usage_avg: cpuUsage,\n    ram_usage_avg: ramUsage,\n    status: status,\n    monthly_cost: monthlyCost,\n    usage_hours_week: usageHours,\n    inactivity_days: 0,\n    alert_sent: false,\n    installed_software_names: installedSoftware.join(', '),\n    chat_id: $('Edit Fields').item.json.chat_id\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2336,
        -960
      ],
      "id": "d94c4803-742f-4665-8588-58fcfe08dd48",
      "name": "Create VM with Software"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1215742180,
          "mode": "list",
          "cachedResultName": "Virtual_Machines",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1215742180"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "vm_id": "={{ $json.vm_id }}",
            "user_id": "={{ $json.user_id }}",
            "vm_name": "={{ $json.vm_name }}",
            "software_installed": "={{ $json.software_installed }}",
            "created_at": "={{ $json.created_at }}",
            "last_active": "={{ $json.last_active }}",
            "cpu_usage_avg": "={{ $json.cpu_usage_avg }}",
            "ram_usage_avg": "={{ $json.ram_usage_avg }}",
            "status": "={{ $json.status }}",
            "monthly_cost": "={{ $json.monthly_cost }}",
            "usage_hours_week": "={{ $json.usage_hours_week }}",
            "inactivity_days": "={{ $json.inactivity_days }}",
            "alert_sent": "={{ $json.alert_sent }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "vm_id",
              "displayName": "vm_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "user_id",
              "displayName": "user_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "vm_name",
              "displayName": "vm_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "software_installed",
              "displayName": "software_installed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "last_active",
              "displayName": "last_active",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cpu_usage_avg",
              "displayName": "cpu_usage_avg",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ram_usage_avg",
              "displayName": "ram_usage_avg",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "monthly_cost",
              "displayName": "monthly_cost",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "usage_hours_week",
              "displayName": "usage_hours_week",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "inactivity_days",
              "displayName": "inactivity_days",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "alert_sent",
              "displayName": "alert_sent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2688,
        -1136
      ],
      "id": "58c1836b-a025-4517-a810-5ccf7110d55d",
      "name": "Save VM to Sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Create VM with Software').item.json.chat_id }}",
        "text": "=‚úÖ –í–ú —Å–æ–∑–¥–∞–Ω–∞!\n\nüì¶ –ù–∞–∑–≤–∞–Ω–∏–µ –í–ò: {{ $json.vm_name }}\nüíø –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –ü–û: {{ $json.software_installed }}\nüìä –°—Ç–∞—Ç—É—Å: {{ $json.status }}\nüí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: {{ $json.monthly_cost }} ‚ÇΩ/–º–µ—Å\n\n‚öôÔ∏è –†–µ—Å—É—Ä—Å—ã:\n‚Ä¢ CPU: ____ %\n‚Ä¢ RAM: ____ %\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ____ —á/–Ω–µ–¥–µ–ª—é\n\n–ö–æ–º–∞–Ω–¥—ã:\nüì± /myresources ‚Äî –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã\nüîç /vmdetails {{ $json.vm_id }} ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2976,
        -976
      ],
      "id": "961fa40d-600f-4dc5-bf7a-7605d30247d4",
      "name": "Send: VM Created",
      "webhookId": "dc4f3e65-b34f-4f4d-89f7-c398efd6638e",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "content": "## –û–±—Ä–∞–±–æ—Ç—á–∏–∫: –°–æ–∑–¥–∞–Ω–∏–µ –í–ú (/create_vm)\n\n1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `/createvm`, —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ø–∞–¥–∞–µ—Ç –∏–∑ `Webhook - Telegram Bot` –≤ `Edit Fields`\n1. –ó–∞—Ç–µ–º —á–µ—Ä–µ–∑ `Command Router` –≤ –≤–µ—Ç–∫—É ¬´**1 - –°–æ–∑–¥–∞–Ω–∏–µ –í–ú**¬ª.\n1. –£–∑–µ–ª `Get User for VM Creation` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã, –∞ `User Registered?` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ –æ–Ω\n1. –ü—Ä–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `Send: Not Registered`.\n1. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, `Get Existing VMs for User` –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –µ–≥–æ –í–ú, –∑–∞—Ç–µ–º `Check License Limit` —Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –í–ú –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –ª–∏–º–∏—Ç–æ–º –ª–∏—Ü–µ–Ω–∑–∏–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Ö–æ–¥–∏—Ç –≤ `Can Create VM?`.\n1. –í `Can Create VM?` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –º–µ–Ω—é –ü–û —á–µ—Ä–µ–∑ `Prepare Software Menu` (–¥–∞–ª–µ–µ ‚Äî —É–∑–µ–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —ç—Ç–æ–≥–æ –º–µ–Ω—é –≤ Telegram), –∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `Send: Limit Exceeded`.\n1. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª –ü–û, –∫–æ–¥–æ–≤—ã–π —É–∑–µ–ª `Create VM with Software` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–æ–≤–æ–π –í–ú –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å, `Save VM to Sheet` –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É **Virtual_Machines**\n1. `Send: VM Created` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram –∏—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –í–ú –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–∏–º –∫–æ–º–∞–Ω–¥–∞–º.\n",
        "height": 1312,
        "width": 2464,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1568,
        -1952
      ],
      "typeVersion": 1,
      "id": "9c6d80cd-51c3-417c-a782-be00a58d4ca1",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "jsCode": "const userData = $('Get User for Resources').first().json;\nconst allVMs = $('Get VMs for Resources').all();\n\n// –§–∏–ª—å—Ç—Ä—É–µ–º –í–ú —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst userVMs = allVMs.filter(vm => vm.json.user_id === userData.user_id);\n\nlet totalCost = 0;\nlet activeCount = 0;\nlet idleCount = 0;\nlet stoppedCount = 0;\nlet activeCost = 0;\nlet idleCost = 0;\nlet stoppedCost = 0;\n\nuserVMs.forEach(vm => {\n  totalCost += vm.json.monthly_cost;\n  \n  if (vm.json.status === 'active') {\n    activeCount++;\n    activeCost += vm.json.monthly_cost;\n  } else if (vm.json.status === 'idle') {\n    idleCount++;\n    idleCost += vm.json.monthly_cost;\n  } else {\n    stoppedCount++;\n    stoppedCost += vm.json.monthly_cost;\n  }\n});\n\nconst licenseMap = {\n  basic: { name: 'Basic', limit: 3, cost: 5000 },\n  standard: { name: 'Standard', limit: 10, cost: 15000 },\n  premium: { name: 'Premium', limit: 50, cost: 40000 }\n};\n\nconst license = licenseMap[userData.license_type];\n\nlet message = `üìä –í–∞—à–∏ —Ä–µ—Å—É—Ä—Å—ã\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n\\n`;\nmessage += `üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userData.username}\\n`;\nmessage += `üíº –õ–∏—Ü–µ–Ω–∑–∏—è: ${license.name} (${userVMs.length}/${license.limit} –í–ú)\\n`;\nmessage += `üí∞ –ó–∞—Ç—Ä–∞—Ç—ã: ${totalCost.toLocaleString()}‚ÇΩ/–º–µ—Å\\n\\n`;\n\nmessage += `üñ•Ô∏è –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã:\\n`;\nmessage += `‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö: ${activeCount} (${activeCost.toLocaleString()}‚ÇΩ)\\n`;\nmessage += `‚ö†Ô∏è –ü—Ä–æ—Å—Ç–∞–∏–≤–∞—é—â–∏—Ö: ${idleCount} (${idleCost.toLocaleString()}‚ÇΩ)\\n`;\nmessage += `‚ùå –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö: ${stoppedCount} (${stoppedCost.toLocaleString()}‚ÇΩ)\\n\\n`;\n\n// –î–û–ë–ê–í–õ–Ø–ï–ú –°–ü–ò–°–û–ö –í–ú\nif (userVMs.length > 0) {\n  message += `üìã –°–ø–∏—Å–æ–∫ –í–ú:\\n`;\n  userVMs.forEach((vm, index) => {\n    const statusIcon = vm.json.status === 'active' ? '‚úÖ' : \n                       vm.json.status === 'idle' ? '‚ö†Ô∏è' : '‚ùå';\n    message += `${index + 1}. ${statusIcon} ${vm.json.vm_name}\\n`;\n    message += `   üíø –ü–û: ${vm.json.software_installed}\\n`;\n    message += `   üí∞ ${vm.json.monthly_cost.toLocaleString()}‚ÇΩ/–º–µ—Å\\n`;\n    message += `   üîç /vmdetails ${vm.json.vm_id}\\n\\n`;\n  });\n}\n\nmessage += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n`;\nmessage += `üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:\\n`;\nmessage += `/optimize - –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\\n`;\nmessage += `/checkidle - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—â–∏–µ –í–ú`;\n\nreturn {\n  json: {\n    message,\n    chat_id: $('Webhook - Telegram Bot').item.json.message.chat.id\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1776,
        528
      ],
      "id": "a124ed41-eebf-45ba-95b7-ff90020780b8",
      "name": "Calculate Summary"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1984,
        528
      ],
      "id": "47ada2b0-29fd-41cf-8ecc-e0ae70e2ab75",
      "name": "Send: Resources Summary",
      "webhookId": "93478464-7aa2-42d3-b91d-00effe75322d",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "content": "## –û–±—Ä–∞–±–æ—Ç—á–∏–∫: –ú–æ–∏ —Ä–µ—Å—É—Ä—Å—ã (/my_resources)\n\n1. –ö–æ–º–∞–Ω–¥–∞ `/myresources` –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `Command Router` –≤ –≤–µ—Ç–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ—Å—É—Ä—Å–æ–≤, –≥–¥–µ —É–∑–µ–ª `Get User for Resources` –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ `Get VMs for Resources` ‚Äî –≤—Å–µ –µ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã.\n1. –ö–æ–¥–æ–≤—ã–π —É–∑–µ–ª `Calculate Summary` –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –í–ú: —Å—á–∏—Ç–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º (**active**/**idle**/**stopped**), –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç —Å –∫—Ä–∞—Ç–∫–∏–º —Å–ø–∏—Å–∫–æ–º –í–ú –∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.\n1. –£–∑–µ–ª `Send: Resources Summary` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —ç—Ç–æ—Ç –æ—Ç—á—ë—Ç –≤ Telegram, —á—Ç–æ–±—ã –æ–Ω –≤–∏–¥–µ–ª –∫–∞—Ä—Ç–∏–Ω—É –ø–æ —Å–≤–æ–∏–º —Ä–µ—Å—É—Ä—Å–∞–º –∏ –º–æ–≥ –ø–µ—Ä–µ–π—Ç–∏ –∫ `/vmdetails`, `/optimize` –∏–ª–∏ `/checkidle`.",
        "height": 592,
        "width": 1648,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        784,
        288
      ],
      "typeVersion": 1,
      "id": "98464509-71f0-40cb-bc25-2c3b1d9bdef1",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## –û–±—Ä–∞–±–æ—Ç—á–∏–∫: AI-–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (/optimize)\n\n1. –ü—Ä–∏ –∫–æ–º–∞–Ω–¥–µ` /optimize` Command Router –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≤–µ—Ç–∫—É –∞–Ω–∞–ª–∏–∑–∞, –≥–¥–µ `Get User for Optimize` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –ª–∏—Ü–µ–Ω–∑–∏–∏, –∞ `Get VMs for Optimize` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –µ–≥–æ –í–ú.\n1. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤ workflow —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω –∫–∞—Ç–∞–ª–æ–≥ –ü–û (—á–µ—Ä–µ–∑ Load Software Catalog), –∏ —É–∑–µ–ª `Build Optimization Prompt` –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –í–ú, –ª–∏—Ü–µ–Ω–∑–∏–∏ –∏ –ü–û —Å–æ–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM.\n1. –£–∑–µ–ª OpenRouter Chat Model (—á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —É–∑–µ–ª `AI Optimization Analysis`) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç, `Add Footer to Message` –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—è—Å–Ω–µ–Ω–∏—è –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏\n1.  `Send: AI Recommendations` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ —É–¥–∞–ª–µ–Ω–∏—é, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—é –í–ú –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏.",
        "height": 544,
        "width": 2048,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1312,
        1792
      ],
      "typeVersion": 1,
      "id": "e96f8c34-9cea-4b79-ba80-f293d1bf9037",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst userData = $('Get User for Optimize').first().json;\n\n// –ü–æ–ª—É—á–∞–µ–º –í–ú –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst allVMs = $('Get VMs for Optimize').all();\n\n// –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –ü–û\nconst software = $input.all();\n\n// –§–∏–ª—å—Ç—Ä—É–µ–º –í–ú —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst userVMs = allVMs.filter(vm => vm.json.user_id === userData.user_id);\n\n// –°–æ–∑–¥–∞—ë–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ü–û\nconst softwareMap = {};\nsoftware.forEach(sw => {\n  softwareMap[sw.json.software_id] = sw.json;\n});\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –í–ú\nlet vmDescriptions = '';\nuserVMs.forEach((vm, index) => {\n  // –ë–ï–ó–û–ü–ê–°–ù–û –ø–∞—Ä—Å–∏–º software_installed (–º–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º –∏–ª–∏ —Å—Ç—Ä–æ–∫–æ–π)\n  let softwareIds = [];\n  if (vm.json.software_installed) {\n    const softwareStr = String(vm.json.software_installed);\n    softwareIds = softwareStr.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));\n  }\n  \n  const softwareNames = softwareIds.map(id => \n    softwareMap[id] ? softwareMap[id].name : 'Unknown'\n  ).join(', ');\n  \n  vmDescriptions += `${index + 1}. ${vm.json.vm_name}\\n`;\n  vmDescriptions += `   –ü–û: ${softwareNames || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ'}\\n`;\n  vmDescriptions += `   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ${vm.json.usage_hours_week || 0} —á–∞—Å–æ–≤/–Ω–µ–¥–µ–ª—é\\n`;\n  vmDescriptions += `   CPU: ${vm.json.cpu_usage_avg || 0}%, RAM: ${vm.json.ram_usage_avg || 0}%\\n`;\n  vmDescriptions += `   –ü—Ä–æ—Å—Ç–æ–π: ${vm.json.inactivity_days || 0} –¥–Ω–µ–π\\n`;\n  vmDescriptions += `   –°—Ç–æ–∏–º–æ—Å—Ç—å: ${vm.json.monthly_cost || 0}‚ÇΩ/–º–µ—Å\\n`;\n  vmDescriptions += `   –°—Ç–∞—Ç—É—Å: ${vm.json.status}\\n\\n`;\n});\n\n// –ï—Å–ª–∏ –Ω–µ—Ç –í–ú\nif (userVMs.length === 0) {\n  return {\n    json: {\n      error: true,\n      message: '‚ùå –£ –≤–∞—Å –Ω–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞\\n\\n–°–æ–∑–¥–∞–π—Ç–µ –í–ú –∫–æ–º–∞–Ω–¥–æ–π /createvm',\n      chat_id: $('Edit Fields').first().json.chat_id\n    }\n  };\n}\n\nconst totalCost = userVMs.reduce((sum, vm) => sum + (vm.json.monthly_cost || 0), 0);\n\nconst prompt = `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω –∏ –¥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.\n\nüìä –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n- –õ–∏—Ü–µ–Ω–∑–∏—è: ${userData.license_type} (${userVMs.length}/${userData.license_limit} –í–ú)\n- –¢–µ–∫—É—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã: ${totalCost}‚ÇΩ/–º–µ—Å\n\nüñ•Ô∏è –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã:\n${vmDescriptions}\n\nüìã –ó–∞–¥–∞—á–∏:\n1. –û–ø—Ä–µ–¥–µ–ª–∏ –í–ú –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (–∫—Ä–∏—Ç–µ—Ä–∏–π: –ø—Ä–æ—Å—Ç–æ–π >14 –¥–Ω–µ–π –ò–õ–ò usage_hours_week <5)\n2. –ù–∞–π–¥–∏ –í–ú –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è (–∫—Ä–∏—Ç–µ—Ä–∏–π: –ø–æ—Ö–æ–∂–∏–π –Ω–∞–±–æ—Ä –ü–û –ò —Å—É–º–º–∞—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ CPU+RAM <140%)\n3. –û—Ü–µ–Ω–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ª–∏—Ü–µ–Ω–∑–∏–∏:\n   - basic: 3 –í–ú, 5000‚ÇΩ/–º–µ—Å\n   - standard: 10 –í–ú, 15000‚ÇΩ/–º–µ—Å\n   - premium: 50 –í–ú, 40000‚ÇΩ/–º–µ—Å\n4. –†–∞—Å—Å—á–∏—Ç–∞–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é —ç–∫–æ–Ω–æ–º–∏—é\n\n–í–µ—Ä–Ω–∏ –æ—Ç–≤–µ—Ç –°–¢–†–û–ì–û –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏–∑ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞, –≥–æ—Ç–æ–≤—ã–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram.`;\n\nreturn {\n  json: {\n    chatInput: prompt,\n    chat_id: $('Edit Fields').first().json.chat_id\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2320,
        1968
      ],
      "id": "305aa05e-6baa-47b4-b604-f6e1c4d653aa",
      "name": "Build Optimization Prompt"
    },
    {
      "parameters": {
        "model": "mistralai/mistral-7b-instruct",
        "options": {
          "maxTokens": 1000,
          "temperature": 0.7
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        2480,
        2160
      ],
      "id": "24e42efa-b599-4695-9fd5-63a12d474d72",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "vTmXgtf5tUnqsJGf",
          "name": "OpenRouter posapr"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3120,
        1952
      ],
      "id": "7d78fd12-f2bb-46ab-b069-ca85186691df",
      "name": "Send: AI Recommendations",
      "webhookId": "8e79902a-e5c9-411d-be06-9bd37e23f7bb",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "content": "## –û–±—Ä–∞–±–æ—Ç—á–∏–∫: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ç–æ—è (/check_idle)\n\n1. –ö–æ–º–∞–Ω–¥–∞ `/checkidle` —Ç–∞–∫–∂–µ –ø–æ–ø–∞–¥–∞–µ—Ç —á–µ—Ä–µ–∑ Command Router –≤ –≤–µ—Ç–∫—É –∞–Ω–∞–ª–∏–∑–∞, –≥–¥–µ `Get User for Idle Check` –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n1. –£–∑–µ–ª `Get VMs for Idle Check` –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –≤—Å–µ –µ–≥–æ –í–ú —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ—Å—Ç–æ—è.\n1. –ö–æ–¥–æ–≤—ã–π —É–∑–µ–ª `Detect Idle VMs` –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –º–∞—à–∏–Ω—ã –ø–æ —É—Ä–æ–≤–Ω—è–º –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ (–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–π, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π, –≤—ã—Å–æ–∫–∏–π, —Å—Ä–µ–¥–Ω–∏–π, –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –∏ —Ç.–¥.), —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é —ç–∫–æ–Ω–æ–º–∏—é –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ.\n1. –£–∑–µ–ª `Send: Idle Report` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–æ—Ç –æ—Ç—á—ë—Ç –≤ Telegram, –≤–∫–ª—é—á–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –í–ú, –ø—Ä–æ—Å—Ç–æ—è–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–∏–º –¥–µ–π—Å—Ç–≤–∏—è–º (–≤ —Ç–æ–º —á–∏—Å–ª–µ —Å—Å—ã–ª–∫—É –Ω–∞ `/optimize`).\n",
        "height": 576,
        "width": 1440
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1328,
        2384
      ],
      "typeVersion": 1,
      "id": "83f57a39-8372-40ee-9ec4-ef5224c61248",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "jsCode": "const userData = $('Get User for Idle Check').first().json;\nconst allVMs = $('Get VMs for Idle Check').all();\n\nconst userVMs = allVMs.filter(vm => vm.json.user_id === userData.user_id);\n\n// –û—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏\nconst catastrophic = []; // >90 –¥–Ω–µ–π, stopped —Å dataLoss –∏–ª–∏ failed\nconst critical = [];     // 30-90 –¥–Ω–µ–π –∏–ª–∏ stopped\nconst high = [];         // 14-30 –¥–Ω–µ–π –∏–ª–∏ idle —Å –Ω–∏–∑–∫–∏–º usage\nconst medium = [];       // 7-14 –¥–Ω–µ–π\nconst normal = [];       // 3-7 –¥–Ω–µ–π\nconst low = [];          // 1-3 –¥–Ω—è\nconst minimal = [];      // <1 –¥–Ω—è\n\n// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –í–ú\nconst realTimeClassification = {\n  active: [],        // –¢–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è (active_session = true)\n  recent: [],        // <15 –º–∏–Ω—É—Ç (0.01 –¥–Ω—è)\n  today: [],         // <24 —á–∞—Å–∞ (<1 –¥–Ω—è)\n  thisWeek: [],      // <7 –¥–Ω–µ–π (—É–∂–µ –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö)\n};\n\n// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—è\nconst now = new Date();\n\nuserVMs.forEach(vm => {\n  const vmData = vm.json;\n  const inactivity = vmData.inactivity_days;\n  const status = vmData.status;\n  const usage = vmData.usage_hours_week;\n  const lastActivity = vmData.last_activity_time ? new Date(vmData.last_activity_time) : null;\n  const hasActiveSession = vmData.active_session === true;\n  \n  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è –≤ —á–∞—Å–∞—Ö/–º–∏–Ω—É—Ç–∞—Ö\n  let exactInactivityHours = inactivity * 24;\n  if (lastActivity) {\n    exactInactivityHours = (now - lastActivity) / (1000 * 60 * 60);\n  }\n  \n  // –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏\n  if ((inactivity >= 90 && status !== 'active') || (status === 'stopped' && (vmData.data_loss === true || vmData.state === 'failed'))) {\n    catastrophic.push(vmData);\n  } else if (inactivity >= 30 || (status === 'stopped' && inactivity >= 14)) {\n    critical.push(vmData);\n  } else if (inactivity >= 14 || (status === 'idle' && usage < 5)) {\n    high.push(vmData);\n  } else if (inactivity >= 7) {\n    medium.push(vmData);\n  } else if (inactivity >= 3) {\n    normal.push(vmData);\n  } else if (inactivity >= 1) {\n    low.push(vmData);\n  } else {\n    minimal.push(vmData);\n  }\n  \n  // –î–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –í–ú (—Ç–µ—Ö, —á—Ç–æ –≤ minimal)\n  if (inactivity < 1) {\n    if (hasActiveSession) {\n      realTimeClassification.active.push(vmData);\n    } else if (exactInactivityHours < 0.25) { // <15 –º–∏–Ω—É—Ç\n      realTimeClassification.recent.push(vmData);\n    } else if (exactInactivityHours < 1) { // <1 —á–∞—Å–∞\n      vmData.inactivity_hours = exactInactivityHours.toFixed(1);\n      realTimeClassification.today.push(vmData);\n    } else {\n      // –û—Å—Ç–∞–ª—å–Ω—ã–µ –í–ú —Å –ø—Ä–æ—Å—Ç–æ—è–º <1 –¥–Ω—è –æ—Å—Ç–∞—é—Ç—Å—è –≤ minimal\n    }\n  }\n});\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç\nlet message = `üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –í–ú\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n\\n`;\n\n// 1. –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å\nif (catastrophic.length > 0) {\n  message += `‚õî –ö–ê–¢–ê–°–¢–†–û–§–ò–ß–ï–°–ö–ò–ô –£–†–û–í–ï–ù–¨ (${catastrophic.length}):\\n`;\n  catastrophic.forEach(vm => {\n    message += `‚î£‚îÅ ${vm.vm_name}\\n`;\n    message += `‚îÉ  ‚îî –ü—Ä–æ—Å—Ç–æ–π: ${vm.inactivity_days} –¥–Ω–µ–π\\n`;\n    message += `‚îÉ  ‚îî –°—Ç–∞—Ç—É—Å: ${vm.status}${vm.data_loss ? ' (–ü–û–¢–ï–†–Ø –î–ê–ù–ù–´–•!)' : ''}\\n`;\n    message += `‚îÉ  ‚îî –ó–∞—Ç—Ä–∞—Ç—ã: ${vm.monthly_cost}‚ÇΩ/–º–µ—Å\\n`;\n    message += `‚îÉ  ‚îî –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –°–†–û–ß–ù–û–ï –í–ú–ï–®–ê–¢–ï–õ–¨–°–¢–í–û\\n‚îÉ\\n`;\n  });\n  message += `\\n`;\n}\n\n// 2. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å\nif (critical.length > 0) {\n  message += `üî¥ –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï (${critical.length}):\\n`;\n  critical.forEach(vm => {\n    message += `‚î£‚îÅ ${vm.vm_name}\\n`;\n    message += `‚îÉ  ‚îî –ü—Ä–æ—Å—Ç–æ–π: ${vm.inactivity_days} –¥–Ω–µ–π\\n`;\n    message += `‚îÉ  ‚îî –ó–∞—Ç—Ä–∞—Ç—ã: ${vm.monthly_cost}‚ÇΩ/–º–µ—Å\\n`;\n    message += `‚îÉ  ‚îî –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –£–¥–∞–ª–∏—Ç—å\\n‚îÉ\\n`;\n  });\n  message += `\\n`;\n}\n\n// 3. –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å\nif (high.length > 0) {\n  message += `üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (${high.length}):\\n`;\n  high.forEach(vm => {\n    message += `‚î£‚îÅ ${vm.vm_name}\\n`;\n    message += `‚îÉ  ‚îî –ü—Ä–æ—Å—Ç–æ–π: ${vm.inactivity_days} –¥–Ω–µ–π\\n`;\n    message += `‚îÉ  ‚îî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ${vm.usage_hours_week || 0}—á/–Ω–µ–¥–µ–ª—é\\n`;\n    message += `‚îÉ  ‚îî –ó–∞—Ç—Ä–∞—Ç—ã: ${vm.monthly_cost}‚ÇΩ/–º–µ—Å\\n`;\n    message += `‚îÉ  ‚îî –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ\\n‚îÉ\\n`;\n  });\n  message += `\\n`;\n}\n\n// 4. –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å\nif (medium.length > 0) {\n  message += `üü° –ú–û–ù–ò–¢–û–†–ò–ù–ì (${medium.length}):\\n`;\n  medium.forEach(vm => {\n    message += `‚îî‚îÅ ${vm.vm_name} (${vm.inactivity_days} –¥–Ω–µ–π –ø—Ä–æ—Å—Ç–æ—è)\\n`;\n  });\n  message += `\\n`;\n}\n\n// 5. –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –∏ –Ω–∏–∑–∫–∏–µ (–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ)\nconst normalLowCount = normal.length + low.length;\nif (normalLowCount > 0) {\n  message += `üü¢ –ê–ö–¢–ò–í–ù–û–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï (${normalLowCount}):\\n`;\n  normal.forEach(vm => {\n    message += `‚îî‚îÅ ${vm.vm_name} (${vm.inactivity_days} –¥–Ω–µ–π)\\n`;\n  });\n  low.forEach(vm => {\n    message += `‚îî‚îÅ ${vm.vm_name} (${vm.inactivity_days} –¥–Ω–µ–π)\\n`;\n  });\n  message += `\\n`;\n}\n\n// 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏\nconst realTimeCount = realTimeClassification.active.length + \n                      realTimeClassification.recent.length + \n                      realTimeClassification.today.length;\n\nif (realTimeCount > 0) {\n  message += `üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò:\\n`;\n  \n  if (realTimeClassification.active.length > 0) {\n    message += `üü¢ –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (${realTimeClassification.active.length}):\\n`;\n    realTimeClassification.active.forEach(vm => {\n      message += `‚îî‚îÅ ${vm.vm_name} (—Å–µ–π—á–∞—Å –æ–Ω–ª–∞–π–Ω)\\n`;\n    });\n    message += `\\n`;\n  }\n  \n  if (realTimeClassification.recent.length > 0) {\n    message += `üü° –ù–µ–¥–∞–≤–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (${realTimeClassification.recent.length}):\\n`;\n    realTimeClassification.recent.forEach(vm => {\n      message += `‚îî‚îÅ ${vm.vm_name} (<15 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥)\\n`;\n    });\n    message += `\\n`;\n  }\n  \n  if (realTimeClassification.today.length > 0) {\n    message += `üîµ –ê–∫—Ç–∏–≤–Ω—ã —Å–µ–≥–æ–¥–Ω—è (${realTimeClassification.today.length}):\\n`;\n    realTimeClassification.today.forEach(vm => {\n      message += `‚îî‚îÅ ${vm.vm_name} (${vm.inactivity_hours || '0.5'} —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥)\\n`;\n    });\n    message += `\\n`;\n  }\n}\n\n// 7. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∏—Ç–æ–≥–∏\nconst totalIdle = catastrophic.length + critical.length + high.length + medium.length;\nconst totalCritical = catastrophic.length + critical.length;\nconst totalActive = userVMs.length - totalIdle;\nconst potentialSaving = [...catastrophic, ...critical, ...high, ...medium]\n  .reduce((sum, vm) => sum + (vm.monthly_cost || 0), 0);\n\nmessage += `üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê:\\n`;\nmessage += `‚î£‚îÅ –í—Å–µ–≥–æ –í–ú: ${userVMs.length}\\n`;\nmessage += `‚î£‚îÅ –ê–∫—Ç–∏–≤–Ω—ã—Ö: ${totalActive}\\n`;\nmessage += `‚î£‚îÅ –ü—Ä–æ—Å—Ç–∞–∏–≤–∞—é—â–∏—Ö: ${totalIdle}\\n`;\nif (totalCritical > 0) {\n  message += `‚î£‚îÅ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö: ${totalCritical}\\n`;\n}\nmessage += `‚îó‚îÅ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è: ${potentialSaving.toLocaleString()}‚ÇΩ/–º–µ—Å\\n\\n`;\n\n// 8. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\nmessage += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n`;\nif (totalIdle > 0) {\n  message += `üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:\\n`;\n  if (catastrophic.length > 0) {\n    message += `‚Ä¢ –°–†–û–ß–ù–û –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –í–ú —Å –ø–æ–º–µ—Ç–∫–æ–π ‚õî\\n`;\n  }\n  if (critical.length > 0 || high.length > 0) {\n    message += `‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /optimize –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞\\n`;\n  }\n  message += `‚Ä¢ –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏—é —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –í–ú\\n`;\n} else {\n  message += `‚úÖ –í—Å–µ –í–ú –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ!\\n`;\n  message += `–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.`;\n}\n\n// 9. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)\nif (realTimeClassification.active.length > 0) {\n  message += `\\n\\nüíª –°–µ–π—á–∞—Å –æ–Ω–ª–∞–π–Ω: ${realTimeClassification.active.length} –í–ú`;\n}\n\nreturn {\n  json: {\n    message,\n    chat_id: $('Webhook - Telegram Bot').item.json.message.chat.id,\n    idle_count: totalIdle,\n    critical_count: totalCritical,\n    potential_saving: potentialSaving,\n    stats: {\n      total: userVMs.length,\n      active: totalActive,\n      idle: totalIdle,\n      catastrophic: catastrophic.length,\n      critical: critical.length,\n      high: high.length,\n      medium: medium.length,\n      realTime: {\n        active: realTimeClassification.active.length,\n        recent: realTimeClassification.recent.length,\n        today: realTimeClassification.today.length\n      }\n    }\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2288,
        2592
      ],
      "id": "a691a219-db15-413c-809e-151b89035904",
      "name": "Detect Idle VMs"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2496,
        2592
      ],
      "id": "f98869f3-ea9b-4dfa-a2f8-842cdca23de2",
      "name": "Send: Idle Report",
      "webhookId": "88bf8701-c882-4d20-aa8a-6cf72294bba2",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "content": "## –û–±—Ä–∞–±–æ—Ç—á–∏–∫: –ö–∞—Ç–∞–ª–æ–≥ –ü–û (/software_catalog)\n\n1. –ü—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã `/softwarecatalog` (–∏–ª–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ–π —Ñ–æ—Ä–º—ã –≤ regex) Command Router –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫ –≤ –≤–µ—Ç–∫—É –∫–∞—Ç–∞–ª–æ–≥–∞ –ü–û.\n1. –£–∑–µ–ª `Load Software Catalog` –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É **Software_Catalog** –∏–∑ Google Sheets\n1. –ü–æ—Å–ª–µ —á–µ–≥–æ `Add Context Info` –æ–±–æ–≥–∞—â–∞–µ—Ç —Å—ã—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–æ–π —Ä–µ—Å—É—Ä—Å–æ—ë–º–∫–æ—Å—Ç–∏).\n1. –ö–æ–¥–æ–≤—ã–π —É–∑–µ–ª `Format Catalog Message` –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ü–û –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å ID, –Ω–∞–∑–≤–∞–Ω–∏–µ–º, –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π, —Ü–µ–Ω–æ–π –∏ –∫—Ä–∞—Ç–∫–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ–º\n1. –£–∑–µ–ª `Send: Software Catalog` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–º–µ—Å—Ç–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä–∞ –ü–û –≤ –∫–æ–º–∞–Ω–¥–µ `/createvm`.",
        "height": 512,
        "width": 1520,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1248,
        -560
      ],
      "typeVersion": 1,
      "id": "7031cc4d-7d50-4e38-8e7c-3ea555f77c80",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1497436515,
          "mode": "list",
          "cachedResultName": "Software_Catalog",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1497436515"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1504,
        -336
      ],
      "id": "90a2b2c5-3884-4718-aaad-0fb28b81523f",
      "name": "Load Software Catalog",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const software = $input.all();\n\nlet message = `üíø –ö–∞—Ç–∞–ª–æ–≥ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–≥–æ –ü–û\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n\\n`;\n\nsoftware.forEach(sw => {\n  message += `${sw.json.software_id}. ${sw.json.name}\\n`;\n  message += `   üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${sw.json.category}\\n`;\n  message += `   üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: ${sw.json.cost_per_month}‚ÇΩ/–º–µ—Å\\n`;\n  message += `   ‚ö° –ù–∞–≥—Ä—É–∑–∫–∞: ${'‚ñì'.repeat(sw.json.resource_weight)}${'‚ñë'.repeat(5 - sw.json.resource_weight)} ${sw.json.resource_weight}/5\\n`;\n  message += `   üìù ${sw.json.description}\\n\\n`;\n});\n\nmessage += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n`;\nmessage += `–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –í–ú —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ü–û:\\n`;\nmessage += `/create_vm [–Ω–æ–º–µ—Ä–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é]\\n`;\nmessage += `–ù–∞–ø—Ä–∏–º–µ—Ä: /create_vm 1,3,5`;\n\nreturn {\n  json: {\n    message,\n    chat_id: $('Webhook - Telegram Bot').item.json.message.chat.id\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2304,
        -224
      ],
      "id": "2aef7410-9ccb-4c84-949f-5dd943029ed5",
      "name": "Format Catalog Message"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2528,
        -224
      ],
      "id": "d0574893-7eb2-4af0-8c5c-ba585dafde40",
      "name": "Send: Software Catalog",
      "webhookId": "cd3482b1-ff27-4bac-828c-31da50453b49",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ POSASPR Helper!\n\n–≠—Ç–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –º–∞—à–∏–Ω–∞–º–∏ —Å –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–º –ü–û.\n\nüìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n\n‚ûï /createvm [ID_–ü–û]\n   –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É\n   –ü—Ä–∏–º–µ—Ä: /createvm 1,3,5\n   –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –ü–û\n\nüìä /myresources\n   –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ —Ä–µ—Å—É—Ä—Å—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n\nü§ñ /optimize\n   AI-–∞–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\n\nüîç /checkidle\n   –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—â–∏–µ –í–ú\n\nüíø /softwarecatalog\n   –ö–∞—Ç–∞–ª–æ–≥ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ü–û\n\nüë§ /register\n   –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ (–Ω–∞ –≤—Å—è–∫–∏–π –ø–æ–∂–∞—Ä–Ω—ã–π)\n\n‚ùì /help\n   –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüí° –ù–∞—á–Ω–∏—Ç–µ —Å /softwarecatalog",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -864,
        -560
      ],
      "id": "1dbc0485-0da9-4942-9bcc-0231d1469b48",
      "name": "Send: Help",
      "webhookId": "ad620208-1b15-40b4-a847-75ae06d8893e",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -864,
        -320
      ],
      "id": "54f6268e-eb31-4b46-a4cf-fe6eafeb6977",
      "name": "Send: Unknown Command",
      "webhookId": "c7a0d21b-1728-47ac-aec8-fe333678e31d",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "messages": {
          "messageValues": [
            {
              "message": "=–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ IT-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω–∞—Ö –∏ –¥–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.\n\n–í–ê–ñ–ù–û: –¢–≤–æ–π –æ—Ç–≤–µ—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º Markdown. –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∞–≤–∏–ª–∞:\n- –ó–∞–≥–æ–ª–æ–≤–∫–∏: **üóëÔ∏è –£–¥–∞–ª–∏—Ç—å** (–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç + —ç–º–æ–¥–∑–∏, –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π ##)\n- –ü—É–Ω–∫—Ç—ã —Å–ø–∏—Å–∫–∞: ‚Ä¢ –∏–ª–∏ -\n- –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç: **—Ç–µ–∫—Å—Ç**\n- –ö—É—Ä—Å–∏–≤: _—Ç–µ–∫—Å—Ç_\n- –ö–æ–¥: `—Ç–µ–∫—Å—Ç`\n\n–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:\n\n**üóëÔ∏è –£–¥–∞–ª–∏—Ç—å**\n\n‚Ä¢ **[vm_name]**: [–ø—Ä–∏—á–∏–Ω–∞]\n  üí∞ –≠–∫–æ–Ω–æ–º–∏—è: [—Å—É–º–º–∞]‚ÇΩ/–º–µ—Å\n\n(–ï—Å–ª–∏ –Ω–µ—Ç –í–ú –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: \"‚úÖ –í—Å–µ –í–ú –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ\")\n\n**üîÄ –û–±—ä–µ–¥–∏–Ω–∏—Ç—å**\n\n‚Ä¢ **[vm_name1]** + **[vm_name2]**: [–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ]\n  üí∞ –≠–∫–æ–Ω–æ–º–∏—è: [—Å—É–º–º–∞]‚ÇΩ/–º–µ—Å\n\n(–ï—Å–ª–∏ –Ω–µ—Ç: \"‚ÑπÔ∏è –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è\")\n\n**üìâ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–∏—Ü–µ–Ω–∑–∏–∏**\n\n[–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∏–ª–∏ \"‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è\"]\n\n**üí∞ –ò—Ç–æ–≥–æ**\n\n–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è: **[—Å—É–º–º–∞]‚ÇΩ/–º–µ—Å** ([–ø—Ä–æ—Ü–µ–Ω—Ç]%)\n\n–ù–ï –¥–æ–±–∞–≤–ª—è–π –Ω–∏–∫–∞–∫–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏, —Ñ—É—Ç–µ—Ä—ã –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ–Ω—Ü–µ!"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        2544,
        1952
      ],
      "id": "62a18e2d-c119-4340-a61b-5319e1f151bd",
      "name": "AI Optimization Analysis"
    },
    {
      "parameters": {
        "content": "## –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 7: –î–µ—Ç–∞–ª–∏ –í–ú (/vm_details)\n\n1. –ö–æ–º–∞–Ω–¥–∞ `/vmdetails` –ø–æ–ø–∞–¥–∞–µ—Ç –∏–∑ Webhook - Telegram Bot —á–µ—Ä–µ–∑ Edit Fields –∏ Command Router –≤ –≤–µ—Ç–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ **2 - –ü—Ä–æ—Å–º–æ—Ç—Ä (–æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–µ)**, –≥–¥–µ –¥–∞–ª–µ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —É–∑–ª–æ–º Switch View`. \n1. –£–∑–µ–ª `Get User for VM Details` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –µ–≥–æ –ø—Ä–∞–≤–∞—Ö –¥–æ—Å—Ç—É–ø–∞ –∫ –í–ú.\n1. –£–∑–µ–ª `Parse VM ID` —Ä–∞–∑–±–∏—Ä–∞–µ—Ç –≤–≤–µ–¥—ë–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–ª–∏ –∏–º—è –í–ú (–∏–∑ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è).\n1. –£–∑–µ–ª `Valid VM ID?` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω; –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `Send: VM Error` —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.\n1. –£–∑–µ–ª `Route VM Lookup` –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫ –ª–∏–±–æ –≤ `Get VM by ID`, –ª–∏–±–æ –≤ `Get VM by Name` (—Ç–∞–±–ª–∏—Ü–∞ **Virtual_Machines**), –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–≤—ë–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.\n1. –£–∑–µ–ª `Merge VM Lookup` –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ ID/–∏–º–µ–Ω–∏ –≤ –µ–¥–∏–Ω—ã–π –æ–±—ä–µ–∫—Ç –í–ú, –∞ –∑–∞—Ç–µ–º Get Software Info for VM –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ü–û –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ **Software_Catalog**.\n1. –£–∑–µ–ª `Format VM Details Message` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –í–ú (—Ä–µ—Å—É—Ä—Å—ã, —Å—Ç–∞—Ç—É—Å, –ø—Ä–æ—Å—Ç–æ–π, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –ü–û, —Å—Ç–æ–∏–º–æ—Å—Ç—å) –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –µ–≥–æ –≤ `Send: VM Details` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram.",
        "height": 720,
        "width": 2512,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        720,
        960
      ],
      "typeVersion": 1,
      "id": "87458785-e57f-40ec-919f-7d826e59334b",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "jsCode": "// –ü–∞—Ä—Å–∏–º –∫–æ–º–∞–Ω–¥—É: /vmdetails [vm_id –∏–ª–∏ vm_name]\nconst message = $('Webhook - Telegram Bot').item.json.message.text;\nconst parts = message.trim().split(' ');\n\nlet vmId = null;\nlet vmName = null;\n\nif (parts.length > 1) {\n  const input = parts[1].trim();\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–≤–µ–¥–µ–Ω–æ: —á–∏—Å–ª–æ –∏–ª–∏ –∏–º—è\n  if (/^\\d+$/.test(input)) {\n    // –í–≤–µ–¥—ë–Ω —á–∏—Å–ª–æ–≤–æ–π ID\n    vmId = parseInt(input);\n  } else if (input.startsWith('VM-')) {\n    // –í–≤–µ–¥–µ–Ω–æ –∏–º—è –í–ú\n    vmName = input;\n  } else {\n    // –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç\n    return {\n      json: {\n        error: true,\n        message: `‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: \"${input}\"\n\n–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /vmdetails [vm_id –∏–ª–∏ vm_name]\n–ü—Ä–∏–º–µ—Ä—ã:\n  /vmdetails 1733158234567\n  /vmdetails VM-526-743610-ANS\n\n–£–∑–Ω–∞—Ç—å –Ω–æ–º–µ—Ä–∞ –í–ú: /myresources`\n      }\n    };\n  }\n}\n\n// –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ\nif (!vmId && !vmName) {\n  return {\n    json: {\n      error: false,\n      help: true,\n      message: `üí° –£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–ª–∏ –∏–º—è –í–ú –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π\n\n–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /vmdetails [vm_id –∏–ª–∏ vm_name]\n–ü—Ä–∏–º–µ—Ä—ã:\n  /vmdetails 1733158234567\n  /vmdetails VM-526-743610-ANS\n\n–£–∑–Ω–∞—Ç—å –Ω–æ–º–µ—Ä–∞ –í–ú: /myresources`\n    }\n  };\n}\n\nreturn {\n  json: {\n    vm_id: vmId,\n    vm_name: vmName,\n    user_id: $input.first().json.user_id\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        1376
      ],
      "id": "2e1e599f-ecbf-420f-8ea5-77fa15db0979",
      "name": "Parse VM ID"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "27b80a8a-d4ba-4e6c-9234-6e555df1374f",
              "leftValue": "={{ $json.error === undefined || $json.error === false }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1280,
        1376
      ],
      "id": "0075a054-fceb-4cb8-881f-f6df0c474bdf",
      "name": "Valid VM ID?"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1497436515,
          "mode": "list",
          "cachedResultName": "Software_Catalog",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1497436515"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2400,
        1312
      ],
      "id": "5b4c96e1-93a8-4417-87f1-dd2a32d8529e",
      "name": "Get Software Info for VM",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ë–ï–ó–û–ü–ê–°–ù–û –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –í–ú (–∏–∑ –ª—é–±–æ–≥–æ —É–∑–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è)\nlet vmData = null;\n\ntry {\n  const byId = $('Get VM by ID');\n  if (byId && byId.first) {\n    vmData = byId.first().json;\n  }\n} catch (e) {\n  // –£–∑–µ–ª –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è\n}\n\nif (!vmData) {\n  try {\n    const byName = $('Get VM by Name');\n    if (byName && byName.first) {\n      vmData = byName.first().json;\n    }\n  } catch (e) {\n    // –£–∑–µ–ª –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è\n  }\n}\n\n// –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî –æ—à–∏–±–∫–∞\nif (!vmData) {\n  return {\n    json: {\n      error: true,\n      message: '‚ùå –í–ú –Ω–µ –Ω–∞–π–¥–µ–Ω–∞\\n\\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /myresources –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞'\n    }\n  };\n}\n\nconst userData = $('Get User for VM Details').first().json;\nconst softwareCatalog = $input.all();\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ –í–ú –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\nif (parseInt(vmData.user_id) !== parseInt(userData.user_id)) {\n  return {\n    json: {\n      error: true,\n      message: '‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –í–ú'\n    }\n  };\n}\n\n// –ë–ï–ó–û–ü–ê–°–ù–û –ø–∞—Ä—Å–∏–º software_installed (–º–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º –∏–ª–∏ —Å—Ç—Ä–æ–∫–æ–π)\nlet softwareIds = [];\nif (vmData.software_installed) {\n  const softwareStr = String(vmData.software_installed); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É\n  softwareIds = softwareStr.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));\n}\n\nlet softwareList = '';\nlet totalCost = 0;\n\nsoftwareIds.forEach(id => {\n  const sw = softwareCatalog.find(s => parseInt(s.json.software_id) === id);\n  if (sw) {\n    softwareList += `   - ${sw.json.name} (${sw.json.cost_per_month}‚ÇΩ/–º–µ—Å)\\n`;\n    totalCost += parseInt(sw.json.cost_per_month);\n  }\n});\n\n// –ï—Å–ª–∏ –ü–û –Ω–µ –Ω–∞–π–¥–µ–Ω–æ\nif (softwareList === '') {\n  softwareList = '   - –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ\\n';\n}\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä\nconst statusEmoji = {\n  'active': '‚úÖ',\n  'idle': '‚ö†Ô∏è',\n  'stopped': '‚ùå'\n};\n\n// –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä\nconst createProgressBar = (value, max = 100) => {\n  const filled = Math.round((value / max) * 10);\n  return '‚ñì'.repeat(filled) + '‚ñë'.repeat(10 - filled);\n};\n\n// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ—Ç–µ—Ä–∏ –æ—Ç –ø—Ä–æ—Å—Ç–æ—è\nconst inactivityDays = parseInt(vmData.inactivity_days || 0);\nconst monthlyCost = parseInt(vmData.monthly_cost || 0);\nconst dailyCost = Math.round(monthlyCost / 30);\nconst wastedCost = dailyCost * inactivityDays;\n\nlet message = `üñ•Ô∏è –î–µ—Ç–∞–ª–∏ –í–ú: ${vmData.vm_name}\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n\\n`;\nmessage += `üìÖ –°–æ–∑–¥–∞–Ω–∞: ${vmData.created_at}\\n`;\nmessage += `üïê –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${vmData.last_active}\\n`;\nmessage += `‚è±Ô∏è –ü—Ä–æ—Å—Ç–æ–π: ${inactivityDays} –¥–Ω–µ–π\\n`;\nmessage += `${statusEmoji[vmData.status] || '‚ùì'} –°—Ç–∞—Ç—É—Å: ${vmData.status}\\n\\n`;\n\nmessage += `üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:\\n`;\nmessage += `CPU: ${createProgressBar(vmData.cpu_usage_avg)} ${vmData.cpu_usage_avg}%\\n`;\nmessage += `RAM: ${createProgressBar(vmData.ram_usage_avg)} ${vmData.ram_usage_avg}%\\n`;\nmessage += `–ß–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é: ${vmData.usage_hours_week}\\n\\n`;\n\nmessage += `üíª –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –ü–û:\\n${softwareList}\\n`;\n\nmessage += `üí∞ –ó–∞—Ç—Ä–∞—Ç—ã: ${monthlyCost.toLocaleString()}‚ÇΩ/–º–µ—Å\\n`;\n\nif (inactivityDays > 0) {\n  message += `üí∏ –ü–æ—Ç–µ—Ä—è–Ω–æ –∑–∞ –ø—Ä–æ—Å—Ç–æ–π: ${wastedCost.toLocaleString()}‚ÇΩ\\n\\n`;\n}\n\nmessage += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n`;\n\n// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞\nif (vmData.status === 'stopped' || inactivityDays >= 14) {\n  message += `‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –£–¥–∞–ª–∏—Ç—å –í–ú\\n`;\n  message += `–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /optimize –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞`;\n} else if (vmData.status === 'idle' || inactivityDays >= 7) {\n  message += `üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å\\n`;\n  message += `–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /checkidle –¥–ª—è –¥–µ—Ç–∞–ª–µ–π`;\n} else {\n  message += `‚úÖ –í–ú –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ`;\n}\n\nreturn {\n  json: {\n    message,\n    chat_id: $('Webhook - Telegram Bot').item.json.message.chat.id,\n    error: false\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2608,
        1312
      ],
      "id": "8af9b652-f7d9-4933-92ea-5db02e8c6b84",
      "name": "Format VM Details Message"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2816,
        1312
      ],
      "id": "6e51d0f6-f541-4cf5-b40c-5392bbb6ac2d",
      "name": "Send: VM Details",
      "webhookId": "be524acc-ca93-4a4a-bbca-1e8fd97b4457",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1616,
        1488
      ],
      "id": "81c24395-3b79-41ed-ad3c-9971be299e49",
      "name": "Send: VM Error",
      "webhookId": "816d45c8-580d-4bbd-af51-fb6f8f3e6d12",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=‚ùå –í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /register –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2192,
        -1440
      ],
      "id": "aeb3c76d-be9f-4e9c-8005-b146e83f191c",
      "name": "Send: Not Registered",
      "webhookId": "4fe1ef05-c004-4b39-bd2a-36cfe52189b5",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ª–∏—Ü–µ–Ω–∑–∏–∏\n\n–¢–µ–∫—É—â–∏—Ö –í–ú: {{ $json.currentCount }}\n–õ–∏–º–∏—Ç: {{ $json.limit }}\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /optimize –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3200,
        -1280
      ],
      "id": "e9b749a5-6fd7-4641-92ae-a8c096f4519f",
      "name": "Send: Limit Exceeded",
      "webhookId": "5f32605f-a685-4109-b29d-d3fb6f5ea4cb",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bbd1ba37-d64d-4440-8cb5-bfd33cd669c6",
              "name": "user_id",
              "value": "={{ $json.message.from.id }}",
              "type": "number"
            },
            {
              "id": "99b307a9-39aa-4761-9d4a-dc48f58d1e25",
              "name": "chat_id",
              "value": "={{ $json.message.chat.id }}",
              "type": "number"
            },
            {
              "id": "3b496a6c-af44-4080-9a0c-44309da9d6a5",
              "name": "text",
              "value": "={{ $json.message.text }}",
              "type": "string"
            },
            {
              "id": "efb3c752-6dbc-4fac-9e69-cf0f380b0364",
              "name": "username",
              "value": "={{ $json.message.from.first_name }} {{ $json.message.from.last_name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3568,
        -1600
      ],
      "id": "7f0dc639-21f8-4352-9d8c-65c124bbcfa9",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_id",
              "lookupValue": "={{ $('Edit Fields').item.json.user_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        848,
        1376
      ],
      "id": "875b6e4b-f659-442d-9980-6f6e44aa0633",
      "name": "Get User for VM Details",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7ac2e5db-7a62-46a6-8387-5388260370e8",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1360,
        528
      ],
      "id": "392f6288-30cb-4f34-9152-7e5882117684",
      "name": "User Found for Resources?"
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=‚ùå –í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /register –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏\n",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1616,
        672
      ],
      "id": "d8d2f7e8-8997-45b9-bef0-ebd1237d19b3",
      "name": "Send: Not Registered for Resources",
      "webhookId": "b495fd62-160a-466e-b57c-88c9df880975",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "54a39efc-c498-47a6-ad04-980a28c47ec9",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1664,
        1968
      ],
      "id": "727f0338-c6f0-4b00-a993-498e5abc3667",
      "name": "User Found for Optimize?"
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=‚ùå –í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /register –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏\n",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1904,
        2144
      ],
      "id": "fa326114-f70c-4009-be4b-33d8f7685343",
      "name": "Send: Not Registered for Optimize",
      "webhookId": "1504e0e5-fcb1-4fa8-b367-ca8f509438fe",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "26e58526-1e6d-4d1b-8efc-8b69b40186ab",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1872,
        2592
      ],
      "id": "d2500af8-f665-4452-8180-761cff2d6f51",
      "name": "User Found for Idle Check?"
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=‚ùå –í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /register –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏\n",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2096,
        2752
      ],
      "id": "a6191849-29eb-4497-a12a-98e1434e9dce",
      "name": "Send: Not Registered for Idle Check",
      "webhookId": "1504e0e5-fcb1-4fa8-b367-ca8f509438fe",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_id",
              "lookupValue": "={{ $('Edit Fields').item.json.user_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1472,
        1968
      ],
      "id": "fa56e53d-8b12-41f3-aefa-12f0840c7b98",
      "name": "Get User for Optimize",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1215742180,
          "mode": "list",
          "cachedResultName": "Virtual_Machines",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1215742180"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "user_id",
              "lookupValue": "={{ $json.user_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1904,
        1968
      ],
      "id": "990d2c65-63fb-456f-82f6-50ed14065c57",
      "name": "Get VMs for Optimize",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_id",
              "lookupValue": "={{ $('Edit Fields').item.json.user_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1664,
        2592
      ],
      "id": "ffff2e25-e592-493d-93d5-0698dba35245",
      "name": "Get User for Idle Check",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1215742180,
          "mode": "list",
          "cachedResultName": "Virtual_Machines",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1215742180"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2080,
        2592
      ],
      "id": "4e953632-4df4-4920-aa3c-bce933026580",
      "name": "Get VMs for Idle Check",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_id",
              "lookupValue": "={{ $('Edit Fields').item.json.user_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1152,
        528
      ],
      "id": "0421317a-a511-4ccf-88a3-48294a72023a",
      "name": "Get User for Resources",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1215742180,
          "mode": "list",
          "cachedResultName": "Virtual_Machines",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1215742180"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1568,
        528
      ],
      "id": "24d430a0-fe5f-4731-9eef-b896a6b0dfe4",
      "name": "Get VMs for Resources",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_id",
              "lookupValue": "={{ $('Edit Fields').item.json.user_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1696,
        -1552
      ],
      "id": "4384c801-bb76-4d4e-bfe6-c87bcbb9183f",
      "name": "Get User for VM Creation",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1215742180,
          "mode": "list",
          "cachedResultName": "Virtual_Machines",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1215742180"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2240,
        -1680
      ],
      "id": "f9255d75-c7dd-44ea-a832-c2d8576b9e81",
      "name": "Get Existing VMs for User",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1022480061,
          "mode": "list",
          "cachedResultName": "User_States",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1022480061"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_id": "={{ $json.telegram_id }}",
            "state": "={{ $json.state }}",
            "timestamp": "={{ $json.timestamp }}",
            "data": "={{ $json.data }}"
          },
          "matchingColumns": [
            "telegram_id"
          ],
          "schema": [
            {
              "id": "telegram_id",
              "displayName": "telegram_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "state",
              "displayName": "state",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3696,
        -1312
      ],
      "id": "0813fb13-9a48-4d7b-8e11-07db3270ee0d",
      "name": "Set User State",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1022480061,
          "mode": "list",
          "cachedResultName": "User_States",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1022480061"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_id",
              "lookupValue": "={{ $('Edit Fields').item.json.user_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -736,
        -1728
      ],
      "id": "ba183aa9-9635-4bee-97ca-9034087cef27",
      "name": "Check User State",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const email = $('Webhook - Telegram Bot').item.json.message.text.trim();\n\n// –í–∞–ª–∏–¥–∞—Ü–∏—è email\nconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\nif (!emailRegex.test(email)) {\n  return {\n    json: {\n      error: true,\n      message: '‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email\\n\\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /cancel'\n    }\n  };\n}\n\nreturn {\n  json: {\n    email,\n    telegram_id: $('Edit Fields').item.json.user_id,\n    chat_id: $('Edit Fields').item.json.chat_id\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        -2416
      ],
      "id": "80f8d9c3-c282-4230-96a5-91ee14d67e1c",
      "name": "Save Email & Request Org"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1022480061,
          "mode": "list",
          "cachedResultName": "User_States",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1022480061"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_id": "={{ $json.telegram_id }}",
            "state": "awaiting_organization",
            "data": "={\"email\": \"{{ $json.email }}\"}",
            "timestamp": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_id"
          ],
          "schema": [
            {
              "id": "telegram_id",
              "displayName": "telegram_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "state",
              "displayName": "state",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        656,
        -2416
      ],
      "id": "b81d870b-f3be-476e-9a2d-d4fb77a995f3",
      "name": "Update State with Email",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Is Register Command?').item.json.chat_id }}",
        "text": "=‚úÖ Email —Å–æ—Ö—Ä–∞–Ω—ë–Ω!\n\n–¢–µ–ø–µ—Ä—å —É–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:\n\n–ü—Ä–∏–º–µ—Ä: –û–û–û \"–†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞\"",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        880,
        -2416
      ],
      "id": "4bde413b-e6d3-4f64-81dd-be8e9a5d0b23",
      "name": "Send Request Organization",
      "webhookId": "123a179a-66e5-4f6b-8436-9233568f6cbf",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dda7c66e-1239-4d73-b40a-a1c9a3a214b1",
              "name": "chat_id",
              "value": "={{ $json.chat_id }}",
              "type": "string"
            },
            {
              "id": "f9beed1e-e2a2-4060-b8a6-043885068a21",
              "name": "menu_text",
              "value": "=üíø –í—ã–±–µ—Ä–∏—Ç–µ –ü–û –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:\n\n1. AutoCAD (CAD) - 3000‚ÇΩ/–º–µ—Å\n2. SolidWorks (CAD) - 3500‚ÇΩ/–º–µ—Å\n3. ANSYS (CAE) - 5000‚ÇΩ/–º–µ—Å\n4. CATIA (CAD/PLM) - 4000‚ÇΩ/–º–µ—Å\n5. MatLab (Programming) - 2500‚ÇΩ/–º–µ—Å\n6. Inventor (CAD) - 3200‚ÇΩ/–º–µ—Å\n7. –ö–æ–º–ø–∞—Å-3D (CAD) - 2000‚ÇΩ/–º–µ—Å\n\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä–∞ –ü–û —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é\n–ù–∞–ø—Ä–∏–º–µ—Ä: 1,3,5\n\n–ò–ª–∏ /cancel –¥–ª—è –æ—Ç–º–µ–Ω—ã",
              "type": "string"
            },
            {
              "id": "badfcae4-7e1b-4814-87ec-98cf6c5d478b",
              "name": "user_id",
              "value": "={{ $json.user_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2976,
        -1712
      ],
      "id": "754e249a-5bec-409c-a551-b2cd5da1fb32",
      "name": "Prepare Software Menu",
      "alwaysOutputData": false,
      "executeOnce": false,
      "retryOnFail": false,
      "notesInFlow": false
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ $('Edit Fields').item.json.username }}!\n\n‚úÖ –¢–µ–ø–µ—Ä—å —É–∫–∞–∂–∏—Ç–µ –í–∞—à Email, —Å –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–º –ü–û:\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        304,
        -2672
      ],
      "id": "5cb3f76f-3119-46dc-8c65-0c031219d3ce",
      "name": "Send Request Email",
      "webhookId": "1a7f7cf2-c502-4ab3-8bec-8c8d131440a7",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "content": "## –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n\n1. –£–∑–µ–ª `Check User State` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–∞–±–ª–∏—Ü–∞ **User_States**) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–∫—Ç–∏–≤–Ω—ã–π ¬´—à–∞–≥¬ª –¥–∏–∞–ª–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç.–ø.).\n1. –£–∑–µ–ª `Route by State` –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ (**4 - User Input** –∏–∑ Command Router) –≤ –Ω—É–∂–Ω—É—é –≤–µ—Ç–∫—É: –æ–±—ã—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤–≤–æ–¥ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤, —à–∞–≥–∏ –º–∞—Å—Ç–µ—Ä–∞ –∏ —Ç.–¥.\n1. –î–ª—è –Ω–æ–≤—ã—Ö –∏–ª–∏ –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å–ª–µ `Send: Not Registered` –æ—Ç–¥–µ–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ –≤ Route by State —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω—É–∂–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–æ–∂–∏–¥–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏/–ø–æ—á—Ç—ã/–ª–∏—Ü–µ–Ω–∑–∏–∏¬ª) –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–∑–ª–æ–≤ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (Send: ...) –∏ –∫–æ–¥–æ–≤—ã—Ö —É–∑–ª–æ–≤ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—ã.\n1. –ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–¥–æ–≤—ã–µ —É–∑–ª—ã –æ–±–Ω–æ–≤–ª—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–µ—Ä–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π **User_States**), –∞ Route by State –ø–æ —ç—Ç–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é —Ä–µ—à–∞–µ—Ç, –∫–∞–∫–æ–π –≤–æ–ø—Ä–æ—Å –∑–∞–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –∏ –∫–æ–≥–¥–∞ —Å—á–∏—Ç–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π.\n1. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ ¬´–æ–±—ã—á–Ω–æ–µ¬ª (–±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞), –∏ –¥–∞–ª—å—à–µ –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (`/createvm`, `/myresources`, `/optimize`, `/checkidle`, `/softwarecatalog`) —Ä–∞–±–æ—Ç–∞—é—Ç —É–∂–µ –≤ —Ä–µ–∂–∏–º–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.",
        "height": 1568,
        "width": 2256
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1104,
        -3104
      ],
      "typeVersion": 1,
      "id": "87f72626-1e09-4de8-a2ec-3e9301b6e7ee",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "user_id": "={{ $json.user_id }}",
            "username": "={{ $json.username }}",
            "email": "=",
            "organization": "=",
            "license_type": "={{ $json.license_type }}",
            "license_limit": "={{ $json.license_limit }}",
            "created_at": "={{ $json.created_at }}",
            "telegram_id": "={{ $json.telegram_id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "user_id",
              "displayName": "user_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "organization",
              "displayName": "organization",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "license_type",
              "displayName": "license_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "license_limit",
              "displayName": "license_limit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_id",
              "displayName": "telegram_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -176,
        -2672
      ],
      "id": "ec2dcbaa-45b7-49f7-98b4-bcf45fd30472",
      "name": "Add New User",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram\nconst telegramData = $('Webhook - Telegram Bot').item.json.message.from;\nconst chatId = $('Edit Fields').item.json.chatid;\n\n// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –Ω–∞ –æ—Å–Ω–æ–≤–µ timestamp + random\nconst newUserId = Math.floor(Math.random() * 1000);\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst firstName = telegramData.first_name || '';\nconst lastName = telegramData.last_name || '';\nconst fullName = lastName ? `${firstName} ${lastName}` : firstName;\nconst telegramUsername = telegramData.username || `user${telegramData.id}`;\n\n// –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst newUser = {\n  user_id: newUserId,\n  username: fullName,\n  email: `${telegramUsername}@telegram.user`,\n  organization: firstName,\n  license_type: 'basic',\n  license_limit: 3,\n  created_at: new Date().toISOString().split('T')[0],\n  telegram_id: telegramData.id.toString()\n};\n\nreturn {\n  json: newUser\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -384,
        -2672
      ],
      "id": "cb5b922c-59c8-4934-82e9-e9ffbe752b63",
      "name": "Generate Registration Data"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "524efa48-0de3-431c-95e7-c3fd7454961f",
              "leftValue": "={{ $('Is Register Command?').item.json.user_id }}",
              "rightValue": "={{ $json.telegram_id }}",
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {
          "ignoreCase": false
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -640,
        -2784
      ],
      "id": "46e29815-aeeb-4e3d-9c3a-86345e084ee6",
      "name": "Already Registered?"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_id",
              "lookupValue": "={{ $('Edit Fields').item.json.user_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -848,
        -2784
      ],
      "id": "0753a08a-2485-4fbf-bf88-e22099781730",
      "name": "Check If User Exists",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "17d5a8b1-6e75-4bce-af33-8a6b5968a94e",
              "leftValue": "={{ $json.message.text }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3840,
        -1584
      ],
      "id": "43f0ff7a-b5cd-4eb2-8240-82ec01349ee2",
      "name": "Has Message"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e535af2d-aef2-4ca3-a78a-875f1390765f",
                    "leftValue": "={{ $('Edit Fields').item.json.text }}",
                    "rightValue": "/softwarecatalog",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–ö–∞—Ç–∞–ª–æ–≥ –ü–û"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Edit Fields').item.json.text }}",
                    "rightValue": "/myresources",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "56cbe9ef-c4cf-46ea-925d-a95795418f6f"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–ú–æ–∏ —Ä–µ—Å—É—Ä—Å—ã"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d41b2f57-2360-451b-9581-734edde4171a",
                    "leftValue": "={{ $('Edit Fields').item.json.text }}",
                    "rightValue": "/vmdetails",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –í–ú"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -400,
        -960
      ],
      "id": "b837a5df-db3b-431a-8a9d-55753a5f8f9f",
      "name": "Switch View"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Edit Fields').item.json.text }}",
                    "rightValue": "/optimize",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "b6b91e10-d533-4c50-aaad-21bb698807af"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a5e034e5-121d-484b-8ebd-33064b2b6f1c",
                    "leftValue": "={{ $('Edit Fields').item.json.text }}",
                    "rightValue": "/checkidle",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ç–æ—è"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        784,
        2112
      ],
      "id": "b8dd0039-e128-4f0a-a112-3404c387519c",
      "name": "Switch Analyze"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_id",
              "lookupValue": "={{ $('Edit Fields').item.json.user_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2832,
        -1872
      ],
      "id": "08e6c6fe-da92-43c0-a81d-430042fdbce0",
      "name": "Check Registration for Start",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "178a088d-9ae4-4527-8dc6-3eadce72c82f",
              "leftValue": "={{ $json.telegram_id }}",
              "rightValue": "={{ $('Is Start Command?').item.json.user_id }}",
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2608,
        -2016
      ],
      "id": "63f1dcea-ccfc-45c6-84b2-569e0c4bbe8a",
      "name": "User Registered for Start?"
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ $('Edit Fields').item.json.username }}!\n\nüìä –í–∞—à–∞ –ª–∏—Ü–µ–Ω–∑–∏—è: {{ $('Check Registration for Start').first().json.license_type }}\nüíº –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: –í–ú –±—É–¥–µ—Ç –ø–æ–¥—Å—á–∏—Ç–∞–Ω–æ/{{ $('Check Registration for Start').first().json.license_limit }}\n\nüìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n\n‚ûï /createvm [ID_–ü–û]\n   –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É\n   –ü—Ä–∏–º–µ—Ä: /createvm 1,3,5\n\nüìä /myresources\n   –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ —Ä–µ—Å—É—Ä—Å—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n\nü§ñ /optimize\n   AI-–∞–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\n\nüîç /checkidle\n   –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—â–∏–µ –í–ú\n\nüíø /softwarecatalog\n   –ö–∞—Ç–∞–ª–æ–≥ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ü–û\n\n‚ùì /help\n   –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞—à–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏!",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2304,
        -2128
      ],
      "id": "8f28d6d2-b726-4193-9e3d-214a6c6a436e",
      "name": "Send: Welcome (Registered)",
      "webhookId": "b51e9a89-f36d-46d0-a1c5-1af42d15e5b8",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c8fbe15d-2261-4264-95e3-c9f9c32cc06d",
              "leftValue": "={{ $json.text }}",
              "rightValue": "=/register",
              "operator": {
                "type": "string",
                "operation": "startsWith"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2608,
        -1504
      ],
      "id": "8568ef81-6343-4601-ba48-c317e498a29e",
      "name": "Is Register Command?"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_id",
              "lookupValue": "={{ $('Edit Fields').item.json.user_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2304,
        -1376
      ],
      "id": "ea66711e-49d2-47e1-94c9-e83ada476d04",
      "name": "Check Registration for Commands",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c91ce669-bc82-458b-ac28-c5591e9bf257",
              "leftValue": "={{ $('Edit Fields').item.json.chat_id }}",
              "rightValue": "={{ $('Is Register Command?').item.json.chat_id }}",
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2064,
        -1360
      ],
      "id": "f80f85ac-8695-4b85-814d-a78e0babd4a6",
      "name": "User Registered for Commands?",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "content": "## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏\n\n1. –õ—é–±–æ–µ –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–º –≤ `Edit Fields` –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Command Router, –≥–¥–µ –∫–æ–º–∞–Ω–¥–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ —Ç–∏–ø–∞–º (—Å–æ–∑–¥–∞–Ω–∏–µ –í–ú, –ø—Ä–æ—Å–º–æ—Ç—Ä, –∞–Ω–∞–ª–∏–∑, –ø–æ–º–æ—â—å –∏ —Ç.–ø.).\n1. –î–ª—è –≤–µ—Ç–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –í–ú –∫–æ–º–∞–Ω–¥–∞ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —É–∑–µ–ª `Get User for VM Creation`, –∫–æ—Ç–æ—Ä—ã–π –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ **Users** –ø–æ Telegram ID –∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—å (—Ç–∏–ø –ª–∏—Ü–µ–Ω–∑–∏–∏, –ª–∏–º–∏—Ç –í–ú –∏ —Ç.–¥.).\n1. –£–∑–µ–ª `User Registered?` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞–π–¥–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å; –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –ø–æ—Ç–æ–∫ —É—Ö–æ–¥–∏—Ç –≤ `Send: Not Registered`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.\n1. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω, –µ–≥–æ –¥–∞–Ω–Ω—ã–µ (user_id, license_type, license_limit –∏ —Ç.–ø.) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–ª–µ–µ –≤ `Get Existing VMs for User` –∏ `Check License Limit` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ –í–ú, –∞–Ω–∞–ª–∏–∑, –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ—Å—É—Ä—Å–æ–≤).\n1. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –≤–µ—Ç–∫–∞—Ö (—Ä–µ—Å—É—Ä—Å—ã, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –ø—Ä–æ—Å—Ç–æ–π), –≥–¥–µ —É–∑–ª—ã `Get User for Resources`, `Get User for Optimize`, `Get User for Idle Check` –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ä–æ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–µ—Ä–µ–¥ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π.",
        "height": 1408,
        "width": 1680
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3200,
        -2400
      ],
      "typeVersion": 1,
      "id": "f24d8507-6ad2-4f35-97b3-bda95a728c88",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω\n\n–í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ.\n\n–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /register\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1856,
        -1168
      ],
      "id": "c9cc58fc-7c4b-40a3-b0d4-6a46f0e7c82d",
      "name": "Send: Please Register First",
      "webhookId": "f1095d5c-9781-41fa-aaeb-09f47e9a0ac6",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏\nif (items.length === 0) {\n  return [];\n}\n\nconst state = items[0].json.state;\nconst stateStr = typeof state === 'string' ? state : String(state || '');\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ\nif (stateStr === 'awaiting_email') {\n  return [{\n    json: {\n      ...items[0].json,\n      route: 'awaiting_email'\n    }\n  }];\n} else if (stateStr === 'awaiting_organization') {\n  return [{\n    json: {\n      ...items[0].json,\n      route: 'awaiting_organization'\n    }\n  }];\n} else if (stateStr === 'awaiting_license_coun') {\n  return [{\n    json: {\n      ...items[0].json,\n      route: 'awaiting_license_coun'\n    }\n  }];\n} else if (stateStr === 'awaiting_software') {\n  return [{\n    json: {\n      ...items[0].json,\n      route: 'awaiting_software'\n    }\n  }];\n} else {\n  return [{\n    json: {\n      ...items[0].json,\n      route: 'unknown'\n    }\n  }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -480,
        -1728
      ],
      "id": "4d3d29f6-6e7e-4504-9603-1d35237c0606",
      "name": "Route by State"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8576fa43-24e9-4000-a00d-6108b2089682",
                    "leftValue": "={{ $json.route }}",
                    "rightValue": "registered",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Register"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.state }}",
                    "rightValue": "awaiting_email",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "427550c6-9bd1-4e19-a1ba-abe2238f9c65"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Email"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b8267457-1161-4f4c-87f8-81ec580cabc5",
                    "leftValue": "={{ $json.state }}",
                    "rightValue": "awaiting_organization",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Org"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f30d0684-230d-45ee-9fb2-d94da9e6d15b",
                    "leftValue": "={{ $json.state }}",
                    "rightValue": "awaiting_license_count",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "License"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b17aedd7-c7ae-4d2b-b3f9-65f628479597",
                    "leftValue": "={{ $json.state }}",
                    "rightValue": "awaiting_software",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Software"
            }
          ]
        },
        "options": {
          "fallbackOutput": "none"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -224,
        -1824
      ],
      "id": "1696a269-87ee-41cd-92ed-5a6fd9cb525c",
      "name": "State Router"
    },
    {
      "parameters": {
        "jsCode": "const userInput = $('Edit Fields').item.json.text;\nconst chatId = $('Edit Fields').item.json.chat_id;\nconst userId = $('Edit Fields').item.json.user_id;\n\n// –ü–æ–ª—É—á–∞–µ–º email –∏–∑ User_States\nconst userState = $('Check User State').first().json;\nlet emailFromState = '';\n\ntry {\n  const data = typeof userState.data === 'string' \n    ? JSON.parse(userState.data) \n    : userState.data;\n  emailFromState = data.email || '';\n} catch (e) {\n  emailFromState = '';\n}\n\nreturn [{\n  json: {\n    telegram_id: userId,\n    email: emailFromState,\n    organization: userInput.trim(),\n    chat_id: chatId\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        -2208
      ],
      "id": "777af290-1ad8-481b-8383-ab93d1d4a4fb",
      "name": "Save Organization & Finish"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_id": "={{ $json.telegram_id }}",
            "email": "={{ $json.email }}",
            "organization": "={{ $json.organization }}",
            "created_at": "={{ $('Check Registration for Commands').item.json.created_at }}"
          },
          "matchingColumns": [
            "telegram_id"
          ],
          "schema": [
            {
              "id": "user_id",
              "displayName": "user_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "organization",
              "displayName": "organization",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "license_type",
              "displayName": "license_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "license_limit",
              "displayName": "license_limit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_id",
              "displayName": "telegram_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        464,
        -2208
      ],
      "id": "a8f4d248-9810-4fdb-80f5-342fafeff602",
      "name": "Update User with Org",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ac38a90c-1028-4783-a794-a592e0eaefb4",
              "leftValue": "={{ $json.text }}",
              "rightValue": "/start",
              "operator": {
                "type": "string",
                "operation": "startsWith"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3072,
        -1616
      ],
      "id": "1ae58036-8cfc-4c69-8b39-f2c5acd9b7c1",
      "name": "Is Start Command?"
    },
    {
      "parameters": {
        "chatId": "={{ $('Edit Fields').item.json.chat_id }}",
        "text": "=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!\n\n–≠—Ç–æ –±–æ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–º –ü–û.\n\n–í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ.\n\n–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /register\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2304,
        -1920
      ],
      "id": "55185d74-da80-4a45-acad-1109ac945ada",
      "name": "Send: Please Register",
      "webhookId": "f1095d5c-9781-41fa-aaeb-09f47e9a0ac6",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "={{ $json.menu_text }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3200,
        -1520
      ],
      "id": "991dd373-936a-4b14-bc4e-e0e1baf08539",
      "name": "Send Software Menu",
      "webhookId": "20d39f99-9ba8-452c-b4e8-c0bb01b1df9b",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json._source }}",
                    "rightValue": "createvm",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "b5d9fcc8-e32a-4006-8d3d-8d61ff60b4fd"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–¥–ª—è /createvm"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1ee8e8ab-ac43-463e-a24c-4b8d17cc889a",
                    "leftValue": "={{ $json._source }}",
                    "rightValue": "softwarecatalog",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–¥–ª—è /softwarecatalog"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        2048,
        -320
      ],
      "id": "d7f06350-cdad-47ea-b1f7-9c6d4d02a9a3",
      "name": "Route Catalog Output"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∞\nconst catalogData = $input.all();\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏\nlet source = 'unknown';\nlet stateInfo = null;\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º State Router\ntry {\n  const stateRouter = $('State Router');\n  if (stateRouter && stateRouter.isExecuted) {\n    const stateData = stateRouter.first().json;\n    source = 'createvm';\n    stateInfo = {\n      state: stateData.state,\n      telegram_id: stateData.telegramid,\n      username: stateData.username\n    };\n  }\n} catch (e) {\n  // State Router –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è\n}\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º Edit Fields –¥–ª—è /softwarecatalog\ntry {\n  const editFields = $('Edit Fields');\n  if (editFields && editFields.item.json.text.includes('softwarecatalog')) {\n    source = 'softwarecatalog';\n  }\n} catch (e) {\n  // –û—à–∏–±–∫–∞\n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º\nreturn catalogData.map(item => ({\n  json: {\n    ...item.json,\n    _source: source,\n    _stateInfo: stateInfo\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1792,
        -336
      ],
      "id": "dd719326-537d-4078-9293-622f494cf72a",
      "name": "Add Context Info"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Get User for VM Creation\nconst userData = $('Get User for VM Creation').first().json;\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è\nreturn {\n  json: {\n    telegram_id: userData.telegram_id,\n    state: 'awaiting_software',\n    timestamp: new Date().toISOString(),\n    data: JSON.stringify({\n      user_id: userData.user_id,\n      username: userData.username,\n      telegram_id: userData.telegram_id\n    })\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3440,
        -1520
      ],
      "id": "22efdc28-5899-4d86-a512-f23bee15e92b",
      "name": "Prepare State Data"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.vm_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "number",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "id": "73ce44bc-ab87-4f3a-ad04-18bae417f8cb"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "By ID"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "529bdd78-cd71-489d-8393-a0d0ab23fc05",
                    "leftValue": "={{ $json.vm_name }}",
                    "rightValue": "By Name",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "By Name"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1616,
        1296
      ],
      "id": "cd77396c-0d03-4f23-be8f-51be0c1680e2",
      "name": "Route VM Lookup"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2144,
        1312
      ],
      "id": "adac37c6-4334-41fb-9849-1166118ac4f2",
      "name": "Merge VM Lookup"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1215742180,
          "mode": "list",
          "cachedResultName": "Virtual_Machines",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1215742180"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "vm_name",
              "lookupValue": "={{ $json.vm_name }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1888,
        1424
      ],
      "id": "21879aa6-02f0-4fa3-87fb-ae66f080c82f",
      "name": "Get VM by Name",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1215742180,
          "mode": "list",
          "cachedResultName": "Virtual_Machines",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1215742180"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "vm_id",
              "lookupValue": "={{ $json.vm_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1888,
        1232
      ],
      "id": "2e5fd2f5-e5bc-438a-afbe-fb3ad127d85c",
      "name": "Get VM by ID",
      "retryOnFail": false,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1497436515,
          "mode": "list",
          "cachedResultName": "Software_Catalog",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1497436515"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2112,
        1968
      ],
      "id": "df47bc59-2d1e-4f9d-91fa-49407c7f99df",
      "name": "Get Software Catalog for Optimize",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç AI\nconst aiResponse = $json.output || $json.text || $json.response || '';\n\n// –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç\nif (!aiResponse) {\n  return {\n    json: {\n      message: '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç AI',\n      chat_id: $('Build Optimization Prompt').first().json.chat_id\n    }\n  };\n}\n\n// –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É—Ç–µ—Ä\nlet message = `ü§ñ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n\\n`;\nmessage += aiResponse;\nmessage += `\\n\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n`;\nmessage += `üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:\\n`;\nmessage += `/myresources - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ—Å—É—Ä—Å—ã\\n`;\nmessage += `/checkidle - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π`;\n\nreturn {\n  json: {\n    message,\n    chat_id: $('Build Optimization Prompt').first().json.chat_id\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2896,
        1952
      ],
      "id": "b7c2fedc-20c4-4af8-9ee0-637ff1d0065d",
      "name": "Add Footer to Message"
    },
    {
      "parameters": {
        "chatId": "={{ $('Save Organization & Finish').item.json.chat_id }}",
        "text": "=‚úÖ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!\n\n–¢–µ–ø–µ—Ä—å —É–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω, –∫–æ—Ç–æ—Ä–æ–µ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:\n\nüíº –¢–∞—Ä–∏—Ñ—ã:\n‚Ä¢ 3-9 –í–ú ‚Üí Basic (5000‚ÇΩ/–º–µ—Å)\n‚Ä¢ 10-49 –í–ú ‚Üí Standard (15000‚ÇΩ/–º–µ—Å)\n‚Ä¢ 50+ –í–ú ‚Üí Premium (40000‚ÇΩ/–º–µ—Å)\n\n–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 3 –¥–æ 999:\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        880,
        -2208
      ],
      "id": "a20770c5-2255-4346-a69d-1be8599c6c10",
      "name": "Send Request License Count",
      "webhookId": "e10db502-b7d8-4dc6-a04a-42ea5ddcd49f",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –£–∑–µ–ª: Save License Count & Finish (Code)\nconst userInput = $('Edit Fields').item.json.text;\nconst licenseCount = parseInt(userInput);\n\n// –í–∞–ª–∏–¥–∞—Ü–∏—è\nif (isNaN(licenseCount) || licenseCount < 3 || licenseCount > 999) {\n  return {\n    json: {\n      error: true,\n      message: `‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ: \"${userInput}\"\n\n–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –í–ú –æ—Ç 3 –¥–æ 999\n\n–ü—Ä–∏–º–µ—Ä—ã:\n‚Ä¢ 5 ‚Üí Basic (–¥–æ 9 –í–ú)\n‚Ä¢ 15 ‚Üí Standard (–¥–æ 49 –í–ú)\n‚Ä¢ 60 ‚Üí Premium (50+ –í–ú)`,\n      chat_id: $('Edit Fields').item.json.chat_id\n    }\n  };\n}\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ª–∏—Ü–µ–Ω–∑–∏–∏\nlet licenseType;\nlet licenseLimit;\n\nif (licenseCount >= 3 && licenseCount <= 9) {\n  licenseType = \"basic\";\n  licenseLimit = licenseCount;\n} else if (licenseCount >= 10 && licenseCount <= 49) {\n  licenseType = \"standard\";\n  licenseLimit = licenseCount;\n} else {\n  licenseType = \"premium\";\n  licenseLimit = licenseCount;\n}\n\n// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è\nconst stateData = $('Check User State').first().json;\nlet parsedData = {};\ntry {\n  parsedData = typeof stateData.data === 'string' \n    ? JSON.parse(stateData.data) \n    : stateData.data || {};\n} catch (e) {\n  parsedData = {};\n}\n\nreturn {\n  json: {\n    telegram_id: $('Edit Fields').item.json.user_id,\n    email: parsedData.email,\n    organization: parsedData.organization,\n    license_type: licenseType,\n    license_limit: licenseLimit,\n    chat_id: $('Edit Fields').item.json.chat_id\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        -2000
      ],
      "id": "07ab76a4-e665-4b24-ba9b-f4159dbfdd7c",
      "name": "Save License Count & Finish"
    },
    {
      "parameters": {
        "chatId": "={{ $json.telegram_id }}",
        "text": "=üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!\n\nüë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ $json.username }}\nüíº –õ–∏—Ü–µ–Ω–∑–∏—è: {{ $json.license_type }} \n\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n/myresources - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ —Ä–µ—Å—É—Ä—Å—ã\n/createvm - –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É\n/softwarecatalog - –ö–∞—Ç–∞–ª–æ–≥ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ü–û",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -384,
        -2880
      ],
      "id": "15bb32a8-1110-4da6-8a24-757eb4852306",
      "name": "Send: Already Registered",
      "webhookId": "072f2c8b-2b5e-4039-960d-39c2eadeefce",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1022480061,
          "mode": "list",
          "cachedResultName": "User_States",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1022480061"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_id": "={{ $json.telegram_id }}",
            "state": "=awaiting_email",
            "timestamp": "={{ new Date().toISOString() }}",
            "data": "={{ JSON.stringify($json.data) }}"
          },
          "matchingColumns": [
            "telegram_id"
          ],
          "schema": [
            {
              "id": "telegram_id",
              "displayName": "telegram_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "state",
              "displayName": "state",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        48,
        -2672
      ],
      "id": "e60d845c-0ec4-4015-8509-738306417a25",
      "name": "Update User State in DB",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_id": "={{ $('Check Registration for Commands').item.json.telegram_id }}",
            "user_id": "={{ $('Check Registration for Commands').item.json.user_id }}",
            "username": "={{ $('Check Registration for Commands').item.json.username }}",
            "license_type": "=",
            "license_limit": "=",
            "created_at": "={{ $('Check Registration for Commands').item.json.created_at }}",
            "email": "={{ $('Save Email & Request Org').item.json.email }}"
          },
          "matchingColumns": [
            "telegram_id"
          ],
          "schema": [
            {
              "id": "user_id",
              "displayName": "user_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "organization",
              "displayName": "organization",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "license_type",
              "displayName": "license_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "license_limit",
              "displayName": "license_limit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_id",
              "displayName": "telegram_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        464,
        -2416
      ],
      "id": "5123e2a5-756e-424b-aabb-54fac5e12c21",
      "name": "Update User with Email",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1022480061,
          "mode": "list",
          "cachedResultName": "User_States",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1022480061"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_id": "={{ $json.telegram_id }}",
            "state": "awaiting_software",
            "data": "={\"license_limit\": \"{{ $json.license_limit }}\"}",
            "timestamp": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_id"
          ],
          "schema": [
            {
              "id": "telegram_id",
              "displayName": "telegram_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "state",
              "displayName": "state",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        656,
        -2000
      ],
      "id": "14a51237-2b8c-4386-89c3-5e1af30263af",
      "name": "Update State with Limit",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Users",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_id": "={{ $('Check Registration for Commands').item.json.telegram_id }}",
            "user_id": "={{ $('Check Registration for Commands').item.json.user_id }}",
            "username": "={{ $('Check Registration for Commands').item.json.username }}",
            "license_type": "={{ $json.license_type }}",
            "license_limit": "={{ $json.license_limit }}",
            "created_at": "={{ $('Check Registration for Commands').item.json.created_at }}",
            "email": "={{ $('Check Registration for Commands').item.json.email }}",
            "organization": "={{ $json.organization }}"
          },
          "matchingColumns": [
            "telegram_id"
          ],
          "schema": [
            {
              "id": "user_id",
              "displayName": "user_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "organization",
              "displayName": "organization",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "license_type",
              "displayName": "license_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "license_limit",
              "displayName": "license_limit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_id",
              "displayName": "telegram_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        464,
        -2000
      ],
      "id": "9f097b90-258e-45ea-9286-6a5d660b980d",
      "name": "Update User with Limit",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Save License Count & Finish').item.json.chat_id }}",
        "text": "=‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n\nüë§ Email: {{ $('Update User with Limit').item.json.email }}\nüè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: {{ $('Update User with Limit').item.json.organization }}\nüíº –õ–∏—Ü–µ–Ω–∑–∏—è: {{ $('Update User with Limit').item.json.license_type }} –Ω–∞ {{ $('Update User with Limit').item.json.license_limit }} –í–ú\n\nüìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n/createvm - –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É\n/myresources - –ú–æ–∏ —Ä–µ—Å—É—Ä—Å—ã\n/help - –°–ø—Ä–∞–≤–∫–∞\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /createvm –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∞—à–µ–π –ø–µ—Ä–≤–æ–π –í–ú!\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        880,
        -2000
      ],
      "id": "480430ff-cfa9-43d3-aeb0-50a05f963a7b",
      "name": "Send: Registration Finish",
      "webhookId": "8e12afc6-5b7c-4bfd-8196-6a49eb0424ca",
      "credentials": {
        "telegramApi": {
          "id": "DDex8oHA77ADeVpY",
          "name": "SmartLicenseUsageAnalyzer_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw",
          "mode": "list",
          "cachedResultName": "POSASPR_Prototype",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1022480061,
          "mode": "list",
          "cachedResultName": "User_States",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1xmPo_70mAeo9xHI7m_uCk9hjJaKGKWixYMDTSQ9h8kw/edit#gid=1022480061"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_id": "={{ $('Edit Fields').item.json.user_id }}",
            "state": "=awaiting_license_count",
            "data": "={\"organization\": \"{{ $json.organization }}\"}",
            "timestamp": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "telegram_id"
          ],
          "schema": [
            {
              "id": "telegram_id",
              "displayName": "telegram_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "state",
              "displayName": "state",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        656,
        -2208
      ],
      "id": "9a2a82ca-9fbd-4393-80f8-b5366ffe9371",
      "name": "Update User State After Org",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "m2R34e9UAiHNipjw",
          "name": "Google Sheets - POSASPR"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook - Telegram Bot": {
      "main": [
        [
          {
            "node": "Has Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Command Router": {
      "main": [
        [
          {
            "node": "Check User State",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get User for VM Creation",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch View",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch Analyze",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send: Help",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send: Unknown Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "User Registered?": {
      "main": [
        [
          {
            "node": "Get Existing VMs for User",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send: Not Registered",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check License Limit": {
      "main": [
        [
          {
            "node": "Can Create VM?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Can Create VM?": {
      "main": [
        [
          {
            "node": "Prepare Software Menu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send: Limit Exceeded",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create VM with Software": {
      "main": [
        [
          {
            "node": "Save VM to Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save VM to Sheet": {
      "main": [
        [
          {
            "node": "Send: VM Created",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Summary": {
      "main": [
        [
          {
            "node": "Send: Resources Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Optimization Analysis",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Build Optimization Prompt": {
      "main": [
        [
          {
            "node": "AI Optimization Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Detect Idle VMs": {
      "main": [
        [
          {
            "node": "Send: Idle Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Load Software Catalog": {
      "main": [
        [
          {
            "node": "Add Context Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Catalog Message": {
      "main": [
        [
          {
            "node": "Send: Software Catalog",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Optimization Analysis": {
      "main": [
        [
          {
            "node": "Add Footer to Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse VM ID": {
      "main": [
        [
          {
            "node": "Valid VM ID?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Valid VM ID?": {
      "main": [
        [
          {
            "node": "Route VM Lookup",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send: VM Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Software Info for VM": {
      "main": [
        [
          {
            "node": "Format VM Details Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format VM Details Message": {
      "main": [
        [
          {
            "node": "Send: VM Details",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send: Limit Exceeded": {
      "main": [
        []
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Is Start Command?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User for VM Details": {
      "main": [
        [
          {
            "node": "Parse VM ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "User Found for Resources?": {
      "main": [
        [
          {
            "node": "Get VMs for Resources",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send: Not Registered for Resources",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "User Found for Optimize?": {
      "main": [
        [
          {
            "node": "Get VMs for Optimize",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send: Not Registered for Optimize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "User Found for Idle Check?": {
      "main": [
        [
          {
            "node": "Get VMs for Idle Check",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send: Not Registered for Idle Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User for Optimize": {
      "main": [
        [
          {
            "node": "User Found for Optimize?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get VMs for Optimize": {
      "main": [
        [
          {
            "node": "Get Software Catalog for Optimize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User for Idle Check": {
      "main": [
        [
          {
            "node": "User Found for Idle Check?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get VMs for Idle Check": {
      "main": [
        [
          {
            "node": "Detect Idle VMs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User for Resources": {
      "main": [
        [
          {
            "node": "User Found for Resources?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get VMs for Resources": {
      "main": [
        [
          {
            "node": "Calculate Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User for VM Creation": {
      "main": [
        [
          {
            "node": "User Registered?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Existing VMs for User": {
      "main": [
        [
          {
            "node": "Check License Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set User State": {
      "main": [
        []
      ]
    },
    "Check User State": {
      "main": [
        [
          {
            "node": "Route by State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Email & Request Org": {
      "main": [
        [
          {
            "node": "Update User with Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update State with Email": {
      "main": [
        [
          {
            "node": "Send Request Organization",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Software Menu": {
      "main": [
        [
          {
            "node": "Send Software Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Request Email": {
      "main": [
        []
      ]
    },
    "Add New User": {
      "main": [
        [
          {
            "node": "Update User State in DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Registration Data": {
      "main": [
        [
          {
            "node": "Add New User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Already Registered?": {
      "main": [
        [
          {
            "node": "Send: Already Registered",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Generate Registration Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check If User Exists": {
      "main": [
        [
          {
            "node": "Already Registered?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Message": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch View": {
      "main": [
        [
          {
            "node": "Load Software Catalog",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get User for Resources",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get User for VM Details",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Analyze": {
      "main": [
        [
          {
            "node": "Get User for Optimize",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get User for Idle Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Registration for Start": {
      "main": [
        [
          {
            "node": "User Registered for Start?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "User Registered for Start?": {
      "main": [
        [
          {
            "node": "Send: Welcome (Registered)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send: Please Register",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Register Command?": {
      "main": [
        [
          {
            "node": "Check If User Exists",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Registration for Commands",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Registration for Commands": {
      "main": [
        [
          {
            "node": "User Registered for Commands?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "User Registered for Commands?": {
      "main": [
        [
          {
            "node": "Command Router",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send: Please Register First",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by State": {
      "main": [
        [
          {
            "node": "State Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "State Router": {
      "main": [
        [],
        [
          {
            "node": "Save Email & Request Org",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Save Organization & Finish",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Save License Count & Finish",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Load Software Catalog",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Organization & Finish": {
      "main": [
        [
          {
            "node": "Update User with Org",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update User with Org": {
      "main": [
        [
          {
            "node": "Update User State After Org",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Start Command?": {
      "main": [
        [
          {
            "node": "Check Registration for Start",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Is Register Command?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Software Menu": {
      "main": [
        [
          {
            "node": "Prepare State Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Catalog Output": {
      "main": [
        [
          {
            "node": "Create VM with Software",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Catalog Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Context Info": {
      "main": [
        [
          {
            "node": "Route Catalog Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare State Data": {
      "main": [
        [
          {
            "node": "Set User State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route VM Lookup": {
      "main": [
        [
          {
            "node": "Get VM by ID",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get VM by Name",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge VM Lookup": {
      "main": [
        [
          {
            "node": "Get Software Info for VM",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get VM by Name": {
      "main": [
        [
          {
            "node": "Merge VM Lookup",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Get VM by ID": {
      "main": [
        [
          {
            "node": "Merge VM Lookup",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Software Catalog for Optimize": {
      "main": [
        [
          {
            "node": "Build Optimization Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Footer to Message": {
      "main": [
        [
          {
            "node": "Send: AI Recommendations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Request License Count": {
      "main": [
        []
      ]
    },
    "Send Request Organization": {
      "main": [
        []
      ]
    },
    "Update User State in DB": {
      "main": [
        [
          {
            "node": "Send Request Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update User with Email": {
      "main": [
        [
          {
            "node": "Update State with Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save License Count & Finish": {
      "main": [
        [
          {
            "node": "Update User with Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update State with Limit": {
      "main": [
        [
          {
            "node": "Send: Registration Finish",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update User with Limit": {
      "main": [
        [
          {
            "node": "Update State with Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update User State After Org": {
      "main": [
        [
          {
            "node": "Send Request License Count",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8c72bc67-88c1-4186-824f-7a7fea64a948",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "f4300700b5a89163b88ad6a908ff9e3076c705e8b03a3f40f03ff2f29f7e4289"
  },
  "id": "GcC24h95FdT2qww1",
  "tags": []
}