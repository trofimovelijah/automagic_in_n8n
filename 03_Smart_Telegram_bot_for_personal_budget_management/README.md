# 03. Telegram-бот для управления личным бюджетом

Этот воркфлоу создает многофункционального Telegram-бота для учета личных финансов. Бот позволяет пользователям устанавливать месячный лимит, фиксировать расходы в свободной форме, запрашивать отчеты и получать советы по оптимизации трат[4].

## Описание

Бот работает как персональный финансовый помощник, управляя состоянием диалога и сохраняя все данные в Google Sheets.

**Основные функции**[4]:
-   **Управление состоянием**: Использует Redis для отслеживания текущего состояния пользователя (например, `setlimit` для установки лимита или `base` для обычного режима).
-   **Учет расходов**: С помощью AI-модели (через OpenRouter) распознает и парсит сообщения в свободной форме (например, «кофе 250 рублей») для извлечения категории и суммы.
-   **Хранение данных**: Все транзакции, лимиты и данные пользователей сохраняются в Google Sheets.
-   **Отчетность**: По команде `/status` или `/report` бот формирует сводку по тратам за текущий месяц и отправляет ее пользователю.
-   **AI-советник**: По запросу пользователя может сгенерировать персональные рекомендации по сокращению расходов на основе истории трат.
-   **Автоматические отчеты**: По расписанию (cron) отправляет ежедневный отчет о расходах за предыдущий день.

## Ключевые компоненты

-   **Telegram Trigger**: Принимает сообщения и колбэки от пользователей.
-   **Redis**: Хранит и извлекает состояние диалога для каждого пользователя.
-   **Google Sheets**: Выступает в роли базы данных для хранения лимитов, пользователей и транзакций.
-   **AI Agent / OpenRouter**: Распознает естественный язык для парсинга расходов и генерации советов.
-   **Code Node**: Используется для обработки данных, валидации, расчетов и подготовки отчетов.
-   **Schedule Trigger (Cron)**: Запускает ежедневную отправку отчетов.

## Настройка и запуск

1.  **Импорт**: Загрузите `workflow.json` в ваш n8n.
2.  **Настройка интеграций**:
    -   **Telegram**: В узлах Telegram укажите API-токен вашего бота.
    -   **Redis**: В узлах Redis укажите учетные данные для подключения к вашему серверу.
    -   **Google Sheets**: Настройте учетные данные OAuth2 и укажите ID ваших таблиц для хранения данных.
    -   **OpenRouter**: В узле AI-модели укажите ваш API-ключ.
3.  **Подготовка Google Sheets**: Создайте таблицу с необходимыми листами и колонками (`Users`, `Spendings`).
4.  **Активация**: Включите воркфлоу. Бот начнет обрабатывать сообщения.
