# 05. RAG на основе Google Docs и Supabase

Этот воркфлоу демонстрирует полный цикл создания и тестирования системы Retrieval-Augmented Generation (RAG). Он состоит из двух независимых, но логически связанных частей: индексации базы знаний из Google Docs и генерации ответов на вопросы с использованием этой базы[6].

## Описание

Воркфлоу позволяет превратить текстовый документ в умную базу знаний, способную давать точные ответы на вопросы, основываясь на содержащейся в ней информации[6].

### Часть 1: Индексация базы знаний

Этот процесс запускается вручную и подготавливает данные для RAG-системы.
1.  **Загрузка**: Текст базы знаний загружается из указанного документа Google Docs.
2.  **Разделение**: Текст разбивается на небольшие, семантически связанные фрагменты (чанки).
3.  **Векторизация**: Каждый чанк преобразуется в числовой вектор (эмбеддинг) с помощью модели (на выбор **OpenAI** `text-embedding-3-large` или **Hugging Face**).
4.  **Сохранение**: Текстовые чанки и их векторы загружаются в **Supabase Vector Store** для последующего поиска.

### Часть 2: Тестирование RAG

Этот процесс также запускается вручную и использует проиндексированную базу для генерации ответов.
1.  **Загрузка вопросов**: Список тестовых вопросов загружается из CSV-файла.
2.  **Поиск контекста**: Для каждого вопроса выполняется семантический поиск в Supabase, чтобы найти наиболее релевантные чанки из базы знаний.
3.  **Генерация ответа**: **AI-модель** (например, `gpt-4o-mini` через OpenRouter) получает вопрос и найденный контекст, после чего генерирует на их основе развернутый ответ.
4.  **Сохранение результатов**: Вопросы, найденный контекст и сгенерированные ответы сохраняются в итоговый файл (Google Sheets или CSV) для оценки качества работы системы.

## Ключевые компоненты

-   **Google Drive/Docs Node**: Для загрузки исходного текста.
-   **Text Splitter Node**: Для разделения текста на чанки.
-   **Embeddings Nodes (OpenAI, Hugging Face)**: Для создания векторных представлений текста.
-   **Supabase Vector Store Node**: Для хранения векторов и выполнения семантического поиска.
-   **AI Agent (Chain)**: Для генерации ответов на основе контекста.
-   **HTTP Request / Read Binary File**: Для загрузки CSV-файла с вопросами.

## Настройка и запуск

1.  **Импорт**: Загрузите `workflow.json` в ваш n8n.
2.  **Настройка кредов**:
    -   **Google**: Настройте учетные данные для Google Drive/Docs.
    -   **Supabase**: Укажите ключи для подключения к вашему проекту Supabase.
    -   **AI-провайдеры**: Введите API-ключи для OpenAI, Hugging Face и/или OpenRouter.
3.  **Индексация**: Запустите вручную ветку индексации, указав ID вашего Google-документа.
4.  **Тестирование**: После успешной индексации запустите вручную ветку тестирования, указав URL к вашему CSV-файлу с вопросами.
